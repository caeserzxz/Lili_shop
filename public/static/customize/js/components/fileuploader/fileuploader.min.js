!
    function(a, b) {
        "function" == typeof define && define.amd ? define(["underscore", "webuploader", "jquery.jplayer"],
            function(c, d) {
                return a.fileUploader = b(c, d)
            }) : "object" == typeof module && "object" == typeof module.exports ? module.exports = b(require("underscore"), require("webuploader"), require("jquery.jplayer"), require("filestyle")) : a.fileUploader = b(jQuery, underscore, WebUploader)
    } (window,
        function(a, b) {
            var c = {
                defaultoptions: {
                    direct: !1,
                    global: !1,
                    dest_dir: "",
                    callback: null,
                    type: "image",
                    mode: "",
                    multiple: !1,
                    allowUploadVideo: !0,
                    fileSizeLimit: !1,
                    uploader: {}
                },
                uploader: {},
                show: function(a, b) {
                    return this.init(a, b)
                },
                init: function(b, c) {
                    var d = this;
                    if (d.options = $.extend({},
                            d.defaultoptions, c), d.options.callback = b, this.options.isWechat) {
                        if (c.account_error) return util.message("公众号号没有上传素材的权限", "", "info"),
                            !1
                    } else this.options.global ? this.options.global = "global": this.options.global = "",
                        document.cookie = "__fileupload_type=" + escape(this.options.type),
                        document.cookie = "__fileupload_dest_dir=" + escape(this.options.dest_dir),
                        document.cookie = "__fileupload_global=" + escape(this.options.global);
                    if ($("#modal-webuploader").remove(), 0 == $("#modal-webuploader").length) {
                        var e = (new Date).getFullYear(),
                            f = {
                                searchyear: {
                                    0 : {
                                        year: e - 0
                                    },
                                    1 : {
                                        year: e - 1
                                    },
                                    2 : {
                                        year: e - 2
                                    },
                                    3 : {
                                        year: e - 3
                                    },
                                    4 : {
                                        year: e - 4
                                    }
                                }
                            };
                        $(document.body).append(a.template(d.buildHtml().mainDialog)(f))
                    }
                    return console.dir($("#modal-webuploader #select-year a")),
                        d.modalobj = $("#modal-webuploader"),
                        d.modalobj.modal("show"),
                        d.modalobj.on("shown.bs.modal",
                            function() {
                                if (!$(this).data("init")) {
                                    switch (d.options.type) {
                                        case "image":
                                        case "thumb":
                                            d.options.isWechat || d.initRemote(),
                                                d.initLocal();
                                            break;
                                        case "audio":
                                            d.initLocalAudio();
                                            break;
                                        case "voice":
                                            d.initLocalVoice();
                                            break;
                                        case "video":
                                            d.options.isWechat || d.initVideoRemote(),
                                            d.options.allowUploadVideo && d.initLocalVideo()
                                    }
                                    d.options.allowUploadVideo && d["init" + d.options.type.substring(0, 1).toUpperCase() + d.options.type.substring(1) + "Uploader"]()
                                }
                            }),
                        d.modalobj
                },
                initUploader: function(a) {
                    function d(d) {
                        var e = $('<li id="' + d.id + '"><p class="title"' + ("audio" == a || "voice" == a ? 'style="top:40px;"': "") + ">" + d.name + '</p><p class="imgWrap"' + ("audio" == a || "voice" == a ? 'style="top:30px;"': "") + "></p></li>"),
                            f = $('<div class="file-panel"><span class="cancel">删除</span></div>').appendTo(e),
                            g = e.find("p.progress span"),
                            h = e.find("p.imgWrap"),
                            i = $('<p class="error"></p>'),
                            j = function(a) {
                                switch (a) {
                                    case "exceed_size":
                                        text = "文件大小超出";
                                        break;
                                    case "interrupt":
                                        text = "上传暂停";
                                        break;
                                    default:
                                        text = "上传失败，请重试"
                                }
                                i.text(text).appendTo(e)
                            };
                        "invalid" === d.getStatus() ? j(d.statusText) : ("image" == a ? (h.text("预览中"), c.makeThumb(d,
                            function(a, b) {
                                if (a) return void h.text("不能预览");
                                var c = $('<img src="' + b + '">');
                                h.empty().append(c)
                            },
                            thumbnailWidth, thumbnailHeight)) : h.text(b.formatSize(d.size) + " kb"), percentages[d.id] = [d.size, 0], d.rotation = 0),
                            d.on("statuschange",
                                function(b, c) {
                                    "progress" === c ? g.hide().width(0) : "queued" === c && (e.off("mouseenter mouseleave"), f.remove()),
                                        "error" === b || "invalid" === b ? (j(d.statusText), percentages[d.id][1] = 1) : "interrupt" === b ? j("interrupt") : "queued" === b ? percentages[d.id][1] = 0 : "progress" === b && (i.remove(), "image" == a && g.css("display", "block")),
                                        e.removeClass("state-" + c).addClass("state-" + b)
                                }),
                            e.on("mouseenter",
                                function() {
                                    f.stop().animate({
                                        height: 30
                                    })
                                }),
                            e.on("mouseleave",
                                function() {
                                    f.stop().animate({
                                        height: 0
                                    })
                                }),
                            f.on("click", "span",
                                function() {
                                    var a, b = $(this).index();
                                    switch (b) {
                                        case 0:
                                            return void c.removeFile(d);
                                        case 1:
                                            d.rotation += 90;
                                            break;
                                        case 2:
                                            d.rotation -= 90
                                    }
                                    supportTransition ? (a = "rotate(" + d.rotation + "deg)", h.css({
                                        "-webkit-transform": a,
                                        "-mos-transform": a,
                                        "-o-transform": a,
                                        transform: a
                                    })) : h.css("filter", "progid:DXImageTransform.Microsoft.BasicImage(rotation=" + ~~ (d.rotation / 90 % 4 + 4) % 4 + ")")
                                }),
                        o.options.multiple && q.find(".fileinput-button").show(),
                            e.insertBefore(q.find(".fileinput-button"))
                    }
                    function e(a) {
                        var b = $("#" + a.id);
                        delete percentages[a.id],
                            f(),
                            b.off().find(".file-panel").off().end().remove()
                    }
                    function f() {
                        var a, b = 0,
                            c = 0,
                            d = v.children();
                        $.each(percentages,
                            function(a, d) {
                                c += d[0],
                                    b += d[0] * d[1]
                            }),
                            a = c ? b / c: 0,
                            d.eq(0).text(Math.round(100 * a) + "%"),
                            d.eq(1).css("width", Math.round(100 * a) + "%"),
                            g()
                    }
                    function g() {
                        var a, d = "";
                        if ("ready" === state) {
                            if (o.options.isWechat) {
                                if ("" == o.options.mode) var e = o.modalobj.find(".nav-pills li.active").attr("data-mode");
                                else var e = o.options.mode;
                                o.options.flag || (c.option("server", c.option("server") + "&mode=" + e + "&types=" + o.options.type), o.options.flag = 1)
                            }
                            d = "选中" + fileCount + typeUnit + i + "，共" + b.formatSize(fileSize) + "。"
                        } else "confirm" === state ? (a = c.getStats(), a.uploadFailNum && (d = "已上传" + a.successNum + typeUnit + i + "," + a.uploadFailNum + typeUnit + i + '上传失败，<a class="retry" href="#">重新上传</a>失败' + i + '或<a class="ignore" href="#">忽略</a>')) : (a = c.getStats(), d = "共" + fileCount + typeUnit + "（" + b.formatSize(fileSize) + "），已上传" + a.successNum + typeUnit, a.uploadFailNum && (d += "，失败" + a.uploadFailNum + typeUnit));
                        s.html(d)
                    }
                    function h(a) {
                        var b;
                        if (a !== state) {
                            switch (t.removeClass("state-" + state), t.addClass("state-" + a), state = a, state) {
                                case "pedding":
                                    u.removeClass("element-invisible"),
                                        q.hide(),
                                        c.refresh();
                                    break;
                                case "ready":
                                    u.addClass("element-invisible"),
                                    o.options.isWechat && "video" == o.options.type && $("#upload form").removeClass("hide"),
                                        q.show(),
                                        c.refresh();
                                    break;
                                case "uploading":
                                    v.show(),
                                        t.text("暂停上传");
                                    break;
                                case "paused":
                                    v.show(),
                                        t.text("继续上传");
                                    break;
                                case "confirm":
                                    if (v.hide(), t.text("开始上传").addClass("disabled"), b = c.getStats(), b.successNum && !b.uploadFailNum) return void h("finish");
                                    break;
                                case "finish":
                                    if (t.removeClass("disabled"), b = c.getStats(), b.successNum) {
                                        if (c.uploadedFiles.length > 0) return o.finish(c.uploadedFiles),
                                            void c.resetUploader()
                                    } else state = "done",
                                        location.reload()
                            }
                            g()
                        }
                    }
                    var i, j, k, l, m, n, o = this;
                    switch (a) {
                        case "image":
                            i = "图片",
                                typeUnit = "张",
                                j = {
                                    title: "Images",
                                    extensions: "gif,jpg,jpeg,bmp,png,ico",
                                    mimeTypes: "image/gif,image/jpg,image/jpeg,image/bmp,image/png,image/ico"
                                },
                                k = 30,
                                l = 5242880,
                                m = k * l,
                                n = o.options.isWechat ? {
                                    quality: 80,
                                    preserveHeaders: !0,
                                    noCompressIfLarger: !0,
                                    compressSize: 1048576
                                }: !1;
                            break;
                        case "audio":
                        case "voice":
                            i = "音频",
                                typeUnit = "个",
                                j = {
                                    title: "Audios",
                                    extensions: "mp3,wma,wav,amr",
                                    mimeTypes: "audio/*"
                                },
                                k = 30,
                                l = 6291456,
                                m = k * l,
                                n = !1,
                            o.options.isWechat && (k = 5, "temp" == o.options.mode ? (j.extensions = "mp3", l = 2097152, m = 10485760) : (l = 5242880, m = 26214400));
                            break;
                        case "video":
                            i = "视频",
                                typeUnit = "个",
                                j = {
                                    title: "Video",
                                    extensions: "rm,rmvb,wmv,avi,mpg,mpeg,mp4",
                                    mimeTypes: "video/*"
                                },
                                k = 30,
                                l = 20971520,
                                m = k * l,
                                n = !1,
                            o.options.isWechat && (k = 5, "temp" == o.options.mode ? (j.extensions = "mp4", l = 10485760, m = 52428800) : (l = 20971520, m = 104857600))
                    }
                    o.options.isWechat ? (o.options.flag = 0, o.modalobj.find("#li_upload_perm a").html("上传永久" + i), o.modalobj.find("#li_upload_temp a").html("上传临时" + i + "(保留3天)")) : o.modalobj.find("#li_upload a").html("上传" + i),
                        o.modalobj.find(".modal-body").append(this.buildHtml().uploaderDialog);
                    var p = $("#uploader"),
                        q = $('<ul class="filelist"><li class="fileinput-button js-add-image" id="filePicker2" style="display:none;"> <a href="javascript:;" class="fileinput-button-icon">+</a></li></ul>').appendTo(p.find(".queueList")),
                        r = p.find(".statusBar"),
                        s = r.find(".info"),
                        t = p.find(".uploadBtn"),
                        u = p.find(".placeholder"),
                        v = r.find(".progress").hide();
                    p.find(".btn-primary");
                    fileCount = 0,
                        fileSize = 0,
                        ratio = window.devicePixelRatio || 1,
                        thumbnailWidth = 110 * ratio,
                        thumbnailHeight = 110 * ratio,
                        state = "pedding",
                        percentages = {},
                        supportTransition = function() {
                            var a = document.createElement("p").style,
                                b = "transition" in a || "WebkitTransition" in a || "MozTransition" in a || "msTransition" in a || "OTransition" in a;
                            return a = null,
                                b
                        } (),
                        c;
                    var w = {
                        pick: {
                            id: "#filePicker",
                            label: "点击选择" + i,
                            multiple: !0
                        },
                        dnd: "#dndArea",
                        paste: "#uploader",
                        swf: "./resource/componets/webuploader/Uploader.swf",
                        //server: o.options.isWechat ? "./index.php?c=utility&a=wechat_file&do=upload": "?c=utility&a=file&do=upload&type=" + a,
                        server: webuploaderEJ + "?type=" + a,
                        compress: n,
                        accept: j,
                        fileNumLimit: k,
                        fileSizeLimit: m,
                        fileSingleSizeLimit: l
                    };
                    w = $.extend({},
                        w, o.options.uploader),
                        w.pick.multiple = o.options.multiple,
                        w.isWechat = o.options.isWechat,
                        w.type = o.options.type,
                        "audio" == a || "voice" == a ? o.options.isWechat ? $("#dndArea p").html("临时语音只支持amr/mp3格式,大小不超过为2M,长度不超过60秒<br>永久语音只支持mp3/wma/wav/amr格式,大小不超过为5M,长度不超过60秒") : $("#dndArea p").html("最大支持 " + b.formatSize(w.fileSingleSizeLimit) + " MB 以内的语音 (" + w.accept.extensions + " 格式)") : "video" == a && (o.options.isWechat ? $("#dndArea p").html("临时视频只支持mp4格式,大小不超过为10M<br>永久视频只支持rm/rmvb/wmv/avi/mpg/mpeg/mp4格式,大小不超过为20M") : $("#dndArea p").html("最大支持 " + b.formatSize(w.fileSingleSizeLimit) + " MB 以内的视频 (" + w.accept.extensions + " 格式)")),
                    o.options.fileSizeLimit && (w.fileSizeLimit = o.options.fileSizeLimit),
                        c = b.create(w),
                        c.uploadedFiles = [],
                        c.addButton({
                            id: "#filePicker2",
                            label: "+",
                            multiple: o.options.multiple
                        }),
                        j = 0,
                        c.resetUploader = function() {
                            if (fileCount = 0, fileSize = 0, j = 0, c.uploadedFiles = [], $.each(c.getFiles(),
                                    function(a, b) {
                                        e(b)
                                    }), o.options.isWechat) {
                                o.options.video && ($("#upload :text[name='title']").val(""), $("#upload :text[name='introduction']").val("")),
                                    f(),
                                    c.reset(),
                                    c.refresh(),
                                    $("#dndArea").removeClass("element-invisible"),
                                    $("#uploader").find(".filelist").empty(),
                                    $("#filePicker").find(".webuploader-pick").next().css({
                                        left: "190px"
                                    });
                                var a = $("#uploader").find(".statusBar");
                                a.find(".info").empty(),
                                    a.find(".accept").empty(),
                                    a.hide()
                            } else c.refresh(),
                                c.reset(),
                                t.removeClass("disabled"),
                                h("pedding")
                        },
                        c.onUploadProgress = function(a, b) {
                            var c = $("#" + a.id),
                                d = c.find(".progress span");
                            d.css("width", 100 * b + "%"),
                                percentages[a.id][1] = b,
                                fileid = a.id,
                                f()
                        },
                        c.onFileQueued = function(a) {
                            fileCount++,
                                fileSize += a.size,
                            1 === fileCount && (u.addClass("element-invisible"), r.show()),
                                d(a),
                                h("ready"),
                                f()
                        },
                        c.onFileDequeued = function(a) {
                            fileCount--,
                                fileSize -= a.size,
                            fileCount || h("pedding"),
                                e(a),
                                f()
                        },
                        c.on("all",
                            function(a) {
                                switch (a) {
                                    case "uploadFinished":
                                        h("confirm");
                                        break;
                                    case "startUpload":
                                        h("uploading");
                                        break;
                                    case "stopUpload":
                                        h("paused")
                                }
                            }),
                        c.on("uploadSuccess",
                            function(a, b) {
                                return b.message ? (alert(b.message), void c.resetUploader()) : void((b.attachment || b.media_id) && (j++, c.uploadedFiles.push(b), $("#" + a.id).append('<span class="success" style="line-height: 50px;">' + b.width + "x" + b.height + "</span>"), $(".accept").text("成功上传 " + j + " " + typeUnit + i)))
                            }),
                        c.onError = function(a) {
                            return "Q_EXCEED_SIZE_LIMIT" == a ? void alert("错误信息: " + i + "大于 " + b.formatSize(w.fileSizeLimit) + " 无法上传.") : "F_DUPLICATE" == a ? void alert("错误信息: 不能重复上传" + i + ".") : void alert("Eroor: " + a)
                        },
                        t.on("click",
                            function() {
                                if ($(this).hasClass("disabled")) return ! 1;
                                if ("pedding" != state && c.options.isWechat && "video" == c.options.type) {
                                    var a = $('#upload :text[name="title"]').val(),
                                        b = $('#upload textarea[name="introduction"]').val();
                                    if (!a) return util.message("视频标题不能为空"),
                                        !1;
                                    if (!b) return util.message("视频描述不能为空"),
                                        !1;
                                    c.option("formData", {
                                        title: a,
                                        introduction: b
                                    })
                                }
                                "ready" === state ? c.upload() : "paused" === state ? c.upload() : "uploading" === state && c.stop()
                            }),
                        s.on("click", ".retry",
                            function() {
                                c.retry()
                            }),
                        s.on("click", ".ignore",
                            function() {}),
                        t.addClass("state-" + state),
                        f()
                },
                initImageUploader: function() {
                    this.initUploader("image")
                },
                initAudioUploader: function() {
                    this.initUploader("audio")
                },
                initVoiceUploader: function() {
                    this.initUploader("voice")
                },
                initVideoUploader: function() {
                    this.initUploader("video")
                },
                initRemote: function() {
                    var a = this;
                    a.modalobj.find("#li_network").removeClass("hide"),
                        a.modalobj.find(".modal-body").append(a.buildHtml().remoteDialog),
                        a.modalobj.find(".btn-primary").click(function() {
                            var b = a.modalobj.find("#networkurl").val();
                            b.length > 0 && "image" == a.options.type && $.getJSON(fetchByEditJ, {
                                    url: b
                                },
                                function(b) {
                                    b.message && alert(b.message),
                                    b && (a.finish([b]), b = {})
                                })
                        })
                },
                initVideoRemote: function() {
                    function a(a) {
                        if (a) {
                            var d = b(a);
                            d = c(d),
                                $("#preview").html('<div style="position:absolute;top:0;margin:0;padding:120px 50px;width:100%;height:100%;font-size:20px;"><span>只支持 腾讯，优酷，土豆视频，如无法预览视频，请前往视频网址处的分享区域，复制通用地址到编辑器内部！</span></div><iframe src="' + d + '" allowfullscreen="true" style="border:0;position:absolute;top:0;left:0;margin:0;padding:0;width:100%;height:100%;"></iframe>')
                        }
                    }
                    function b(a) {
                        if (!a) return "";
                        var b, c;
                        if (a.indexOf("v.qq.com") >= 0) {
                            if (b = a.match(/vid\=([^\&]*)($|\&)/), b ? c = "http://v.qq.com/iframe/player.html?vid=" + b[1] + "&tiny=0&auto=0": (b = a.match(/\/([0-9a-zA-Z]+).html/), b && (c = "http://v.qq.com/iframe/player.html?vid=" + b[1] + "&tiny=0&auto=0")), !b) return
                        } else if (a.indexOf("v.youku.com") >= 0) b = a.match(/id_(.*)\.html/),
                            c = "http://player.youku.com/embed/" + b[1];
                        else {
                            if (! (a.indexOf("tudou.com") >= 0)) return;
                            b = a.match(/\/([-\w]+)/g),
                                b = b[b.length - 1].substring(1),
                                c = "http://www.tudou.com/programs/view/html5embed.action?code=" + b
                        }
                        return c
                    }
                    function c(a, b) {
                        return a ? a.replace(b || /[<">']/g,
                            function(a) {
                                return {
                                    "<": "&lt;",
                                    "&": "&amp;",
                                    '"': "&quot;",
                                    ">": "&gt;",
                                    "'": "&#39;"
                                } [a]
                            }) : ""
                    }
                    var d = this;
                    d.modalobj.find("#li_network").removeClass("hide"),
                        d.modalobj.find(".modal-body").append(d.buildHtml().remoteVideoDialog),
                        d.modalobj.find("#networkurl").blur(function() {
                            var b = $(this).val();
                            b.length > 0 ? a(b) : $("#preview").html("")
                        }),
                        d.modalobj.find(".btn-primary").click(function() {
                            var a = d.modalobj.find("#networkurl").val();
                            if (a.length > 0 && "video" == d.options.type) {
                                var e = b(a);
                                e = c(e),
                                    d.finish([{
                                        url: e,
                                        isRemote: !0
                                    }])
                            }
                        })
                },
                initLocal: function() {
                    var a = this;
                    a.modalobj.find("#li_history_image").removeClass("hide"),
                        a.modalobj.find(".modal-body").append(this.buildHtml().localDialog),
                        a.localPage(1)
                },
                localPage: function(b) {
                    var c = this;
                    if (c.options.isWechat) var d = c.options.type,
                        e = c.options.mode,
                        f = "./index.php?c=utility&a=wechat_file&do=browser",
                        g = {
                            page: b,
                            type: d,
                            mode: e,
                            psize: 32
                        };
                    else var h = c.modalobj.find("#select-year .btn-info").data("id"),
                        i = c.modalobj.find("#select-month .btn-info").data("id"),
                        f = webUploadByManagerJ,
                        g = {
                            page: b,
                            year: h,
                            month: i
                        };
                    var j = c.modalobj.find("#history_image");
                    var now = new Date(); //当前日期
                    var nowMonth = now.getMonth(); //当前月
                    if (typeof(h) == 'undefined'){
                        $('#select-year').find('a').eq(0).addClass('btn-info');
                        $('#select-month').find('a').eq(nowMonth).addClass('btn-info');
                    }
                    return $.getJSON(f, g,
                        function(b) {
                            b = b.message.message,
                                j.find(".history-content").css("text-align", "center").html('<i class="fa fa-spinner fa-pulse fa-5x"></i>'),
                                j.find("#image-list-pager").html(""),
                                a.isEmpty(b.items) ? j.find(".history-content").css("text-align", "left").html('<i class="fa fa-info-circle"></i> 暂无数据') : (j.data("attachment", b.items), j.find(".history-content").empty(), j.find(".history-content").html(a.template(c.buildHtml()[c.options.isWechat ? "weixin_localDialogLi": "localDialogLi"])(b)), j.find("#image-list-pager").html(b.page), j.find(".pagination a").click(function() {
                                    c.localPage($(this).attr("page"))
                                }), j.find(".img-list li").click(function(a) {
                                    c.selectImage($(a.target).parents("li"))
                                }), c.options.isWechat ? c.weixinDeletefile() : c.deletefile())
                        }),
                    c.options.isWechat || c.modalobj.find(".btn-select").unbind("click").click(function() {
                        return $(this).hasClass("btn-info") ? !1 : ("month" == $(this).data("type") && $(this).data("id") > 0 && (c.modalobj.find("#select-year .btn-info").data("id") || (c.modalobj.find("#select-year .btn-select").removeClass("btn-info"), c.modalobj.find("#select-year .btn-select").eq(1).addClass("btn-info"))), $(this).siblings().removeClass("btn-info"), $(this).addClass("btn-info"), void c.localPage(1))
                    }),
                        j.find(".btn-primary").unbind("click").click(function() {
                            var a = [];
                            j.find(".img-item-selected").each(function() {
                                a.push(c.modalobj.find("#history_image").data("attachment")[$(this).attr("attachid")]),
                                    $(this).removeClass("img-item-selected")
                            }),
                                c.finish(a)
                        }),
                        !1
                },
                deletefile: function() {
                    var a = this;
                    a.modalobj.find("#history_image .img-list li .btnClose").unbind().click(function() {
                        var a = $(this),
                            b = $(this).data("id");
                        return b ? ($.post("./index.php?c=utility&a=file&do=delete", {
                                id: b
                            },
                            function(b) {
                                "success" != b ? alert(b) : (a.parent().remove(), util.message("删除成功", "", "success"))
                            }), !1) : !1
                    })
                },
                weixinDeletefile: function() {
                    var a = this;
                    a.modalobj.find(".history .delete-file").off("click"),
                        a.modalobj.find(".history .delete-file").on("click",
                            function(a) {
                                var b = $(this);
                                if (confirm("确定要删除文件吗？")) {
                                    var c = $(this).parent().attr("attachid"),
                                        d = $(this).parent().attr("data-type");
                                    $.post("./index.php?c=utility&a=wechat_file&do=delete", {
                                            id: c
                                        },
                                        function(a) {
                                            var a = $.parseJSON(a);
                                            return a.error ? void("image" == d ? b.parent().remove() : "audio" != d && "voice" != d && "video" != d || b.parents("tr").remove()) : (util.message(a.message), !1)
                                        })
                                }
                                a.stopPropagation()
                            })
                },
                selectImage: function(a) {
                    var b = this;
                    $(a).toggleClass("img-item-selected"),
                        b.options.isWechat ? b.options.direct && b.modalobj.find("#history_image").find(".btn-primary").trigger("click") : b.options.multiple || b.modalobj.find("#history_image").find(".btn-primary").trigger("click")
                },
                initLocalAudio: function() {
                    var a = this;
                    a.modalobj.find("#li_history_audio").removeClass("hide"),
                        a.modalobj.find(".modal-body").append(this.buildHtml().localAudioDialog),
                        a.localAudioPage(1)
                },
                localAudioPage: function(b) {
                    var c = this;
                    if (c.options.isWechat) var d = c.options.type,
                        e = c.options.mode,
                        f = "./index.php?c=utility&a=wechat_file&do=browser",
                        g = {
                            page: b,
                            type: d,
                            mode: e,
                            psize: 5
                        };
                    else var f = webUploadByManagerJ+'/type/audio';//"./index.php?c=utility&a=file&do=local&type=audio&pagesize=5",
                        g = {
                            page: b
                        };
                    var h = c.modalobj.find("#history_audio");
                    return $.getJSON(f, g,
                        function(b) {
                            b = b.message,
                                h.find(".history-content").html('<i class="fa fa-spinner fa-pulse"></i>'),
                                a.isEmpty(b.items) ? h.find(".history-content").css("text-align", "center").html('<i class="fa fa-info-circle"></i> 暂无数据') : (h.data("attachment", b.items), h.find(".history-content").empty(), h.find(".history-content").html(a.template(c.buildHtml()[c.options.isWechat ? "weixin_localAudioDialogLi": "localAudioDialogLi"])(b)), h.find("#image-list-pager").html(b.page), h.find(".pagination a").click(function() {
                                    c.localAudioPage($(this).attr("page"))
                                }), h.find(".js-btn-select").click(function(a) {
                                    $(a.target).toggleClass("btn-primary"),
                                        c.options.isWechat ? c.options.direct && c.modalobj.find("#history_audio").find(".modal-footer .btn-primary").trigger("click") : c.options.multiple || c.modalobj.find("#history_audio").find(".modal-footer .btn-primary").trigger("click")
                                }), c.playAudio(), c.options.isWechat && c.weixinDeletefile())
                        }),
                        h.find(".modal-footer .btn-primary").unbind("click").click(function() {
                            var a = [];
                            h.find(".history-content .btn-primary").each(function() {
                                a.push(c.modalobj.find("#history_audio").data("attachment")[$(this).attr("attachid")]),
                                    $(this).removeClass("btn-primary")
                            }),
                                c.finish(a)
                        }),
                        !1
                },
                playAudio: function() {
                    var a = this,
                        b = a.modalobj.find("#history_audio");
                    $(".audio-player-play").click(function() {
                        var a = $(this).attr("attach");
                        if (a) {
                            if ($("#player")[0]) var c = $("#player");
                            else {
                                var c = $('<div id="player"></div>');
                                $(document.body).append(c)
                            }
                            c.data("control", $(this)),
                                c.jPlayer({
                                    playing: function() {
                                        $(this).data("control").find("p").removeClass("fa-play").addClass("fa-stop")
                                    },
                                    pause: function(a) {
                                        $(this).data("control").find("p").removeClass("fa-stop").addClass("fa-play")
                                    },
                                    swfPath: "resource/components/jplayer",
                                    supplied: "mp3,wma,wav,amr",
                                    solution: "html, flash"
                                }),
                                c.jPlayer("setMedia", {
                                    mp3: $(this).attr("attach")
                                }).jPlayer("play"),
                                $(this).find("p").hasClass("fa-stop") ? c.jPlayer("stop") : (b.find(".fa-stop").removeClass("fa-stop").addClass("fa-play"), c.jPlayer("setMedia", {
                                    mp3: $(this).attr("attach")
                                }).jPlayer("play"))
                        }
                    })
                },
                initLocalVoice: function() {
                    this.initLocalAudio()
                },
                initLocalVideo: function() {
                    var a = this;
                    a.modalobj.find("#li_history_video").removeClass("hide"),
                        a.modalobj.find(".modal-body").append(this.buildHtml().localVideoDialog),
                        a.localVideoPage(1)
                },
                localVideoPage: function(b) {
                    var c = this;
                    if (c.options.isWechat) var d = c.options.type,
                        e = "./index.php?c=utility&a=wechat_file&do=browser",
                        f = {
                            page: b,
                            type: d,
                            psize: 5
                        };
                    else var e = "./index.php?c=utility&a=file&do=local&type=video&pagesize=5",
                        f = {
                            page: b
                        };
                    var g = c.modalobj.find("#history_video");
                    return $.getJSON(e, f,
                        function(b) {
                            b = b.message,
                                g.find(".history-content").html('<i class="fa fa-spinner fa-pulse"></i>'),
                                a.isEmpty(b.items) ? g.find(".history-content").css("text-align", "left").html('<i class="fa fa-info-circle"></i> 暂无数据') : (g.data("attachment", b.items), g.find(".history-content").empty(), g.find(".history-content").html(a.template(c.buildHtml()[c.options.isWechat ? "weixin_localVideoDialogLi": "localVideoDialogLi"])(b)), g.find("#image-list-pager").html(b.page), g.find(".pagination a").click(function() {
                                    c.localVideoPage($(this).attr("page"))
                                }), g.find(".js-btn-select").click(function(a) {
                                    $(a.target).toggleClass("btn-primary"),
                                        c.options.isWechat ? c.options.direct && c.modalobj.find("#history_video").find(".modal-footer .btn-primary").trigger("click") : c.options.multiple || c.modalobj.find("#history_video").find(".modal-footer .btn-primary").trigger("click")
                                }), c.options.isWechat && c.weixinDeletefile())
                        }),
                        g.find(".modal-footer .btn-primary").unbind("click").click(function() {
                            var a = [];
                            g.find(".history-content .btn-primary").each(function() {
                                a.push(c.modalobj.find("#history_video").data("attachment")[$(this).attr("attachid")]),
                                    $(this).removeClass("btn-primary")
                            }),
                                c.finish(a)
                        }),
                        !1
                },
                finish: function(a) {
                    var b = this;
                    $.isFunction(b.options.callback) && (0 == b.options.multiple ? b.options.callback(a[0]) : b.options.callback(a), b.modalobj.modal("hide"))
                },
                buildHtml: function() {
                    var a = {};
                    return a.mainDialog = '<div id="modal-webuploader" class="modal fade" tabindex="-1" role="dialog" aria-hidden="true">\n	<div class="modal-dialog">\n		<div class="modal-content" style="width:785px">\n			<div class="modal-header">\n				<button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>\n				<ul class="nav nav-pills" role="tablist">\n					<li id="li_upload" ' + (!this.options.isWechat && this.options.allowUploadVideo ? 'class="active"': 'class="hide"') + ' role="presentation"><a href="#upload" aria-controls="upload" role="tab" data-toggle="tab" onclick="$(\'#select\').hide();">上传</a></li>\n					<li id="li_upload_perm" ' + (this.options.isWechat ? 'class="active"': 'class="hide"') + ' data-mode="perm" role="presentation"><a href="#upload" aria-controls="upload" role="tab" data-toggle="tab" onclick="$(\'#select\').hide();">上传</a></li>\n					<li id="li_upload_temp" ' + (this.options.isWechat ? "": 'class="hide"') + 'data-mode="temp" role="presentation"><a href="#upload" aria-controls="upload" role="tab" data-toggle="tab" onclick="$(\'#select\').hide();">上传</a></li>\n					<li id="li_network" ' + (this.options.allowUploadVideo ? 'class="hide"': 'class="active"') + ' role="presentation"><a href="#network" aria-controls="network" role="tab" data-toggle="tab" onclick="$(\'#select\').hide();">提取网络' + ("video" == this.options.type ? "视频": "图片") + '</a></li>\n					<li id="li_history_image" class="hide" role="presentation"><a href="#history_image" aria-controls="history_image" role="tab" data-toggle="tab" onclick="$(\'#select\').show();">浏览图片</a></li>\n					<li id="li_history_audio-iqgmy" class="hide" role="presentation"><a href="#history_audio" aria-controls="history_audio" role="tab" data-toggle="tab" onclick="$(\'#select\').hide();">浏览音频</a></li>\n					<li id="li_history_video" class="hide" role="presentation"><a href="#history_video" aria-controls="history_video" role="tab" data-toggle="tab">浏览视频</a></li>\n				</ul>\n			</div>\n' + (this.options.isWechat ? "": '				<div id="select" style="display: none;margin:10px 0 -10px 15px; padding-left:7px;">					<div id="select-year" style="margin-bottom:10px;">						<div class="btn-group">													<%_.each(searchyear, function(item) {%> \n							<a href="javascript:;" data-id="<%=item.year%>" data-type="year" class="btn btn-default btn-select"><%=item.year%>年</a>							<%});%>\n						</div>					</div>					<div id="select-month">						<div class="btn-group">														<a href="javascript:;" data-id="1" data-type="month" class="btn btn-default btn-select">1</a>							<a href="javascript:;" data-id="2" data-type="month" class="btn btn-default btn-select">2</a>							<a href="javascript:;" data-id="3" data-type="month" class="btn btn-default btn-select">3</a>							<a href="javascript:;" data-id="4" data-type="month" class="btn btn-default btn-select">4</a>							<a href="javascript:;" data-id="5" data-type="month" class="btn btn-default btn-select">5</a>							<a href="javascript:;" data-id="6" data-type="month" class="btn btn-default btn-select">6</a>							<a href="javascript:;" data-id="7" data-type="month" class="btn btn-default btn-select">7</a>							<a href="javascript:;" data-id="8" data-type="month" class="btn btn-default btn-select">8</a>							<a href="javascript:;" data-id="9" data-type="month" class="btn btn-default btn-select">9</a>							<a href="javascript:;" data-id="10" data-type="month" class="btn btn-default btn-select">10</a>							<a href="javascript:;" data-id="11" data-type="month" class="btn btn-default btn-select">11</a>							<a href="javascript:;" data-id="12" data-type="month" class="btn btn-default btn-select">12</a>						</div>					</div>				</div>') + '			<div class="modal-body tab-content"></div>\n		</div>\n	</div>\n</div>',
                        a.uploaderDialog = '<div role="tabpanel" class="tab-pane upload active" id="upload">\n' + (this.options.isWechat && "video" == this.options.type ? '<form class="form-horizontal hide" style="padding-right:10px;">			<div class="form-group">				<label class="col-xs-12 col-sm-2 control-label">视频标题</label>				<div class="col-sm-10">					<input type="text" name="title" class="form-control" placeholder="视频标题">				</div>			</div>			<div class="form-group">				<label class="col-xs-12 col-sm-2 control-label">视频描述</label>				<div class="col-sm-10">					<textarea name="introduction" class="form-control" placeholder="视频描述"></textarea>				</div>			</div></form>': "") + '	<div id="uploader" class="uploader">\n		<div class="queueList">\n			<div id="dndArea" class="placeholder">\n				<div id="filePicker">xx</div>\n' + (this.options.multiple ? '<p id="">或将照片拖到这里，单次最多可选' + (this.options.isWechat ? 5 : 30) + "张</p>\n": '<p id="">或将照片拖到这里</p>\n') + '			</div>\n		</div>\n		<div class="statusBar">\n			<div class="infowrap">\n				<div class="progress">\n					<span class="text">0%</span>\n					<span class="percentage"></span>\n				</div>\n				<div class="info"></div>\n				<div class="accept"></div>\n			</div>\n			<div class="btns">\n				<div class="uploadBtn btn btn-primary" style="margin-top: 4px;">确定使用</div>\n				<div class="modal-button-upload" style="float: right; margin-left: 5px;">\n					<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n				</div>\n			</div>\n		</div>\n	</div>\n</div>',
                        a.remoteDialog = '<div role="tabpanel" class="tab-pane network" id="network">\n	<div style="margin-top: 10px;">\n		<form>\n			<div class="form-group">\n				<input type="url" class="form-control" id="networkurl" placeholder="请输入网络图片地址">\n				<input type="hidden" name="network_attachment" value="" >\n				<div id="network-img" class="network-img" style="background-image:url(\'{php echo tomedia(\'images/global/nopic.jpg\');}\')">\n					<span class="network-img-sizeinfo" id="network-img-sizeinfo"></span>\n				</div>\n			</div>\n		</form>\n	</div>\n	<div class="modal-footer" style="margin:0 -30px -30px;">\n		<button type="button" class="btn btn-primary">确认</button>\n		<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n	</div>\n</div>',
                        a.remoteVideoDialog = '<div role="tabpanel" class="tab-pane network' + (this.options.allowUploadVideo ? " ": " active") + '" id="network">\n	<div style="margin-top: 10px;">\n		<form>\n			<div class="form-group">\n				<div style="margin: -10px 0 10px 0;">为了在微信中有更好的体验，推荐使用<a href="http://v.qq.com" target="_blank">腾讯视频</a></div>\n				<input type="url" class="form-control" id="networkurl" placeholder="请输入网络视频地址">\n				<div id="preview" style="position:relative;width:600px;height:300px;margin:0 auto;margin-top:15px;text-align:center;background:#ccc;">\n				</div>\n			</div>\n		</form>\n	</div>\n	<div class="modal-footer" style="margin:0 -30px -30px;">\n		<button type="button" class="btn btn-primary">确认</button>\n		<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n	</div>\n</div>',
                        a.localDialog = '<div role="tabpanel" class="tab-pane history" id="history_image">\n	<div class="history-content" style="height:310px;overflow-y: auto;"></div>\n	<nav id="image-list-pager" class="text-right we7-margin-vertical">\n			<ul class="pager" style="margin: 0;"></ul>\n	</nav>\n	<div class="modal-footer" style="margin:0 -30px -30px;">\n		<div style="float: right;">\n		<button ' + (this.options.multiple ? "": 'style="display:none;"') + ' type="button" class="btn btn-primary">确认</button>\n' + (this.options.multiple ? '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n': "") + "		</div>\n	</div>\n</div>",
                        a.localDialogLi = '<ul class="img-list clearfix">\n<%var items = _.sortBy(items, function(item) {return -item.id;});%><%_.each(items, function(item) {%> \n<li class="img-item" attachid="<%=item.id%>" title="<%=item.filename%>">\n	<div class="img-container" style="background-image: url(\'<%=item.url%>\');">\n		<div class="select-status"><span></span></div>\n	</div>\n	<div class="btnClose" data-id="<%=item.id%>"><a href=""><i class="fa fa-times"></i></a></div>\n</li>\n<%});%>\n</ul>',
                        a.weixin_localDialogLi = '<ul class="img-list clearfix">\n<%_.each(items, function(item) {%> \n<li class="img-item" attachid="<%=item.id%>" data-type="image" title="<%=item.filename%>">\n	<div class="btnClose delete-file"><a href="javascript:;"><i class="fa fa-times"></i></a></div>	<div class="img-container" style="background-image: url(\'<%=item.url%>\');">\n		<div class="select-status"><span></span></div>\n	</div>\n</li>\n<%});%>\n</ul>',
                        a.localAudioDialog = '<div role="tabpanel" class="tab-pane history" id="history_audio">\n	<div style="height:310px; overflow-x:hidden; overflow-y: auto;">\n		<table class="table table-hover we7-table">\n		<thead class="navbar-inner">\n			<tr>\n				<th>标题</th>\n' + (this.options.isWechat ? '				<th style="width:30%;text-align:right">创建时间</th>\n				<th style="width:30%;text-align:right">\n					<div class="input-group input-group-sm hide">\n': '				<th style="width:20%;">创建时间</th>\n				<th style="width:30%;">\n					<div class="input-group input-group-sm">\n') + '						<input type="text" class="form-control">\n						<span class="input-group-btn">\n							<button class="btn btn-default" type="button"><i class="fa fa-search" style="font-size:12px; margin-top:0;"></i></button>\n						</span>\n					</div>\n				</th>\n			</tr>\n		</thead>\n		<tbody class="history-content">\n		</tbody>\n	</table></div>\n	<nav id="image-list-pager" class="text-right we7-margin-vertical">\n		<ul class="pager" style="margin: 0;"></ul>\n	</nav>\n	<div class="modal-footer" style="margin:0 -30px -30px;">\n		<div style="float: right;">\n		<button ' + (this.options.multiple ? "": 'style="display:none;"') + ' type="button" class="btn btn-primary">确认</button>\n' + (this.options.multiple ? '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n': "") + "		</div>\n	</div>\n</div>",
                        a.localAudioDialogLi = '<%var items = _.sortBy(items, function(item) {return -item.id;});%><%_.each(items, function(item) {%> \n<tr>\n	<td><a href="#" title="<%=item.filename%>"><%=item.filename%></a></td>\n	<td class="text-right"><%=item.createtime%></td>\n	<td class="text-right">\n		<span class="input-group-btn">\n			<button class="btn btn-default audio-player-play" type="button" attach="<%=item.url%>"><p style="margin:0px;" class="fa fa-play"></p></button>\n			<button attachid="<%=item.id%>" class="btn btn-default js-btn-select">选取</button>\n		</span>\n	</td>\n</tr>\n<%});%>\n',
                        a.weixin_localAudioDialogLi = '<%var items = _.sortBy(items, function(item) {return -item.id;});%><%_.each(items, function(item) {%> \n<tr>\n	<td><a href="<%=item.url%>" target="blank" title="<%=item.filename%>"><%=item.filename%></a></td>\n	<td class="text-right"><%=item.createtime%></td>\n	<td class="text-right">\n		<span class="input-group-btn" attachid="<%=item.id%>" data-type="audio">\n			<button class="btn btn-default audio-player-play" type="button" attach="<%=item.url%>"><p style="margin:0px;" class="fa fa-play"></p></button>\n			<button class="btn btn-default delete-file">删除</button>\n			<button attachid="<%=item.id%>" class="btn btn-default js-btn-select">选取</button>\n		</span>\n	</td>\n</tr>\n<%});%>\n',
                        a.localVideoDialog = '<div role="tabpanel" class="tab-pane history" id="history_video">\n	<div style="height:310px; overflow-x:hidden; overflow-y:auto;">\n		<table class="table table-hover we7-table">\n		<thead class="navbar-inner">\n			<tr>\n				<th>标题</th>\n				<th style="width:30%;text-align:right">创建时间</th>\n				<th style="width:30%;text-align:right">\n					<div class="input-group input-group-sm hide">\n						<input type="text" class="form-control">\n						<span class="input-group-btn">\n							<button class="btn btn-default" type="button"><i class="fa fa-search" style="font-size:12px; margin-top:0;"></i></button>\n						</span>\n					</div>\n				</th>\n			</tr>\n		</thead>\n		<tbody class="history-content">\n		</tbody>\n	</table></div>\n	<nav id="image-list-pager" class="text-right we7-margin-vertical">\n		<ul class="pager" style="margin: 0;"></ul>\n	</nav>\n	<div class="modal-footer" style="margin:0 -30px -30px;">\n		<div style="float: right;">\n		<button ' + (this.options.multiple ? "": 'style="display:none;"') + ' type="button" class="btn btn-primary">确认</button>\n' + (this.options.multiple ? '<button type="button" class="btn btn-default" data-dismiss="modal">取消</button>\n': "") + "		</div>\n	</div>\n</div>",
                        a.localVideoDialogLi = '<%var items = _.sortBy(items, function(item) {return -item.id;});%><%_.each(items, function(item) {%> \n<tr>\n	<td><a href="#" title="<%=item.filename%>"><%=item.filename%></a></td>\n	<td class="text-right"><%=item.createtime%></td>\n	<td class="text-right">\n		<span class="input-group-btn">\n			<button attachid="<%=item.id%>" class="btn btn-default js-btn-select">选取</button>\n		</span>\n	</td>\n</tr>\n<%});%>\n',
                        a.weixin_localVideoDialogLi = '<%var items = _.sortBy(items, function(item) {return -item.id;});%><%_.each(items, function(item) {%> \n<tr>\n	<td><a href="<%=item.url%>" target="blank" title="<%=item.filename%>"><%=item.filename%></a></td>\n	<td class="text-right"><%=item.createtime%></td>\n	<td class="text-right">\n		<span class="input-group-btn" attachid="<%=item.id%>" data-type="audio">\n			<button class="btn btn-default delete-file">删除</button>\n			<button attachid="<%=item.id%>" class="btn btn-default js-btn-select">选取</button>\n		</span>\n	</td>\n</tr>\n<%});%>\n',
                        a
                }
            };
            return c
        });