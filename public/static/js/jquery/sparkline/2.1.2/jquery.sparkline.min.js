define(function(n){var t=n("$");(function(n){"use strict";var o={},d,t,r,f,s,u,c,g,nt,l,at,tt,it,rt,e,ut,ft,h,a,et,ot,st,v,y,p,ht,ct,lt,w,b,k,i,vt=0;d=function(){return{common:{type:"line",lineColor:"#00f",fillColor:"#cdf",defaultPixelsPerValue:3,width:"auto",height:"auto",composite:!1,tagValuesAttribute:"values",tagOptionsPrefix:"spark",enableTagOptions:!1,enableHighlight:!0,highlightLighten:1.4,tooltipSkipNull:!0,tooltipPrefix:"",tooltipSuffix:"",disableHiddenCheck:!1,numberFormatter:!1,numberDigitGroupCount:3,numberDigitGroupSep:",",numberDecimalMark:".",disableTooltips:!1,disableInteraction:!1},line:{spotColor:"#f80",highlightSpotColor:"#5f5",highlightLineColor:"#f22",spotRadius:1.5,minSpotColor:"#f80",maxSpotColor:"#f80",lineWidth:1,normalRangeMin:undefined,normalRangeMax:undefined,normalRangeColor:"#ccc",drawNormalOnTop:!1,chartRangeMin:undefined,chartRangeMax:undefined,chartRangeMinX:undefined,chartRangeMaxX:undefined,tooltipFormat:new r('<span style="color: {{color}}">&#9679;<\/span> {{prefix}}{{y}}{{suffix}}')},bar:{barColor:"#3366cc",negBarColor:"#f44",stackedBarColor:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],zeroColor:undefined,nullColor:undefined,zeroAxis:!0,barWidth:4,barSpacing:1,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:!1,colorMap:undefined,tooltipFormat:new r('<span style="color: {{color}}">&#9679;<\/span> {{prefix}}{{value}}{{suffix}}')},tristate:{barWidth:4,barSpacing:1,posBarColor:"#6f6",negBarColor:"#f44",zeroBarColor:"#999",colorMap:{},tooltipFormat:new r('<span style="color: {{color}}">&#9679;<\/span> {{value:map}}'),tooltipValueLookups:{map:{"-1":"Loss","0":"Draw","1":"Win"}}},discrete:{lineHeight:"auto",thresholdColor:undefined,thresholdValue:0,chartRangeMax:undefined,chartRangeMin:undefined,chartRangeClip:!1,tooltipFormat:new r("{{prefix}}{{value}}{{suffix}}")},bullet:{targetColor:"#f33",targetWidth:3,performanceColor:"#33f",rangeColors:["#d3dafe","#a8b6ff","#7f94ff"],base:undefined,tooltipFormat:new r("{{fieldkey:fields}} - {{value}}"),tooltipValueLookups:{fields:{r:"Range",p:"Performance",t:"Target"}}},pie:{offset:0,sliceColors:["#3366cc","#dc3912","#ff9900","#109618","#66aa00","#dd4477","#0099c6","#990099"],borderWidth:0,borderColor:"#000",tooltipFormat:new r('<span style="color: {{color}}">&#9679;<\/span> {{value}} ({{percent.1}}%)')},box:{raw:!1,boxLineColor:"#000",boxFillColor:"#cdf",whiskerColor:"#000",outlierLineColor:"#333",outlierFillColor:"#fff",medianColor:"#f00",showOutliers:!0,outlierIQR:1.5,spotRadius:1.5,target:undefined,targetColor:"#4a2",chartRangeMax:undefined,chartRangeMin:undefined,tooltipFormat:new r("{{field:fields}}: {{value}}"),tooltipFormatFieldlistKey:"field",tooltipValueLookups:{fields:{lq:"Lower Quartile",med:"Median",uq:"Upper Quartile",lo:"Left Outlier",ro:"Right Outlier",lw:"Left Whisker",rw:"Right Whisker"}}}}};ht='.jqstooltip { position: absolute;left: 0px;top: 0px;visibility: hidden;background: rgb(0, 0, 0) transparent;background-color: rgba(0,0,0,0.6);filter:progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000);-ms-filter: "progid:DXImageTransform.Microsoft.gradient(startColorstr=#99000000, endColorstr=#99000000)";color: white;font: 10px arial, san serif;text-align: left;white-space: nowrap;padding: 5px;border: 1px solid white;z-index: 10000;}.jqsfield { color: white;font: 10px arial, san serif;text-align: left;}';t=function(){var t,i;return t=function(){this.init.apply(this,arguments)},arguments.length>1?(arguments[0]?(t.prototype=n.extend(new arguments[0],arguments[arguments.length-1]),t._super=arguments[0].prototype):t.prototype=arguments[arguments.length-1],arguments.length>2&&(i=Array.prototype.slice.call(arguments,1,-1),i.unshift(t.prototype),n.extend.apply(n,i))):t.prototype=arguments[0],t.prototype.cls=t,t};n.SPFormatClass=r=t({fre:/\{\{([\w.]+?)(:(.+?))?\}\}/g,precre:/(\w+)\.(\d+)/,init:function(n,t){this.format=n;this.fclass=t},render:function(n,t,i){var s=this,h=n,f,e,u,r,o;return this.format.replace(this.fre,function(){var n;return(e=arguments[1],u=arguments[3],f=s.precre.exec(e),f?(o=f[2],e=f[1]):o=!1,r=h[e],r===undefined)?"":u&&t&&t[u]?(n=t[u],n.get?t[u].get(r)||r:t[u][r]||r):(nt(r)&&(r=i.get("numberFormatter")?i.get("numberFormatter")(r):rt(r,o,i.get("numberDigitGroupCount"),i.get("numberDigitGroupSep"),i.get("numberDecimalMark"))),r)})}});n.spformat=function(n,t){return new r(n,t)};f=function(n,t,i){return n<t?t:n>i?i:n};s=function(n,t){var i;return t===2?(i=Math.floor(n.length/2),n.length%2?n[i]:(n[i-1]+n[i])/2):n.length%2?(i=(n.length*t+t)/4,i%1?(n[Math.floor(i)]+n[Math.floor(i)-1])/2:n[i-1]):(i=(n.length*t+2)/4,i%1?(n[Math.floor(i)]+n[Math.floor(i)-1])/2:n[i-1])};u=function(n){var t;switch(n){case"undefined":n=undefined;break;case"null":n=null;break;case"true":n=!0;break;case"false":n=!1;break;default:t=parseFloat(n);n==t&&(n=t)}return n};c=function(n){for(var i=[],t=n.length;t--;)i[t]=u(n[t]);return i};g=function(n,t){for(var u=[],i=0,r=n.length;i<r;i++)n[i]!==t&&u.push(n[i]);return u};nt=function(n){return!isNaN(parseFloat(n))&&isFinite(n)};rt=function(t,i,r,u,f){var e,o;for(t=(i===!1?parseFloat(t).toString():t.toFixed(i)).split(""),e=(e=n.inArray(".",t))<0?t.length:e,e<t.length&&(t[e]=f),o=e-r;o>0;o-=r)t.splice(o,0,u);return t.join("")};l=function(n,t,i){for(var r=t.length;r--;)if((!i||t[r]!==null)&&t[r]!==n)return!1;return!0};at=function(n){for(var i=0,t=n.length;t--;)i+=typeof n[t]=="number"?n[t]:0;return i};it=function(t){return n.isArray(t)?t:[t]};tt=function(n){var t;document.createStyleSheet?document.createStyleSheet().cssText=n:(t=document.createElement("style"),t.type="text/css",document.getElementsByTagName("head")[0].appendChild(t),t[typeof document.body.style.WebkitAppearance=="string"?"innerText":"innerHTML"]=n)};n.fn.simpledraw=function(t,i,r,u){var f,e,o;if(r&&(f=this.data("_jqs_vcanvas")))return f;if(n.fn.sparkline.canvas===!1)return!1;if(n.fn.sparkline.canvas===undefined)if(o=document.createElement("canvas"),!(o.getContext&&o.getContext("2d")))if(document.namespaces&&!document.namespaces.v)document.namespaces.add("v","urn:schemas-microsoft-com:vml","#default#VML"),n.fn.sparkline.canvas=function(n,t,i){return new k(n,t,i)};else return n.fn.sparkline.canvas=!1,!1;else n.fn.sparkline.canvas=function(n,t,i,r){return new b(n,t,i,r)};return t===undefined&&(t=n(this).innerWidth()),i===undefined&&(i=n(this).innerHeight()),f=n.fn.sparkline.canvas(t,i,this,u),e=n(this).data("_jqs_mhandler"),e&&e.registerCanvas(f),f};n.fn.cleardraw=function(){var n=this.data("_jqs_vcanvas");n&&n.reset()};n.RangeMapClass=e=t({init:function(n){var i,t,r=[];for(i in n)n.hasOwnProperty(i)&&typeof i=="string"&&i.indexOf(":")>-1&&(t=i.split(":"),t[0]=t[0].length===0?-Infinity:parseFloat(t[0]),t[1]=t[1].length===0?Infinity:parseFloat(t[1]),t[2]=n[i],r.push(t));this.map=n;this.rangelist=r||!1},get:function(n){var i=this.rangelist,r,t,u;if((u=this.map[n])!==undefined)return u;if(i)for(r=i.length;r--;)if(t=i[r],t[0]<=n&&t[1]>=n)return t[2];return undefined}});n.range_map=function(n){return new e(n)};ut=t({init:function(t,i){var r=n(t);this.$el=r;this.options=i;this.currentPageX=0;this.currentPageY=0;this.el=t;this.splist=[];this.tooltip=null;this.over=!1;this.displayTooltips=!i.get("disableTooltips");this.highlightEnabled=!i.get("disableHighlight")},registerSparkline:function(n){this.splist.push(n);this.over&&this.updateDisplay()},registerCanvas:function(t){var i=n(t.canvas);this.canvas=t;this.$canvas=i;i.mouseenter(n.proxy(this.mouseenter,this));i.mouseleave(n.proxy(this.mouseleave,this));i.click(n.proxy(this.mouseclick,this))},reset:function(n){this.splist=[];this.tooltip&&n&&(this.tooltip.remove(),this.tooltip=undefined)},mouseclick:function(t){var i=n.Event("sparklineClick");i.originalEvent=t;i.sparklines=this.splist;this.$el.trigger(i)},mouseenter:function(t){n(document.body).unbind("mousemove.jqs");n(document.body).bind("mousemove.jqs",n.proxy(this.mousemove,this));this.over=!0;this.currentPageX=t.pageX;this.currentPageY=t.pageY;this.currentEl=t.target;!this.tooltip&&this.displayTooltips&&(this.tooltip=new ft(this.options),this.tooltip.updatePosition(t.pageX,t.pageY));this.updateDisplay()},mouseleave:function(){n(document.body).unbind("mousemove.jqs");var i=this.splist,f=i.length,r=!1,u,t;for(this.over=!1,this.currentEl=null,this.tooltip&&(this.tooltip.remove(),this.tooltip=null),t=0;t<f;t++)u=i[t],u.clearRegionHighlight()&&(r=!0);r&&this.canvas.render()},mousemove:function(n){this.currentPageX=n.pageX;this.currentPageY=n.pageY;this.currentEl=n.target;this.tooltip&&this.tooltip.updatePosition(n.pageX,n.pageY);this.updateDisplay()},updateDisplay:function(){var r=this.splist,o=r.length,s=!1,h=this.$canvas.offset(),c=this.currentPageX-h.left,l=this.currentPageY-h.top,u,i,t,f,e;if(this.over){for(t=0;t<o;t++)i=r[t],f=i.setRegionHighlight(this.currentEl,c,l),f&&(s=!0);if(s){if(e=n.Event("sparklineRegionChange"),e.sparklines=this.splist,this.$el.trigger(e),this.tooltip){for(u="",t=0;t<o;t++)i=r[t],u+=i.getCurrentRegionTooltip();this.tooltip.setContent(u)}this.disableHighlight||this.canvas.render()}f===null&&this.mouseleave()}}});ft=t({sizeStyle:"position: static !important;display: block !important;visibility: hidden !important;float: left !important;",init:function(t){var r=t.get("tooltipClassname","jqstooltip"),u=this.sizeStyle,i;this.container=t.get("tooltipContainer")||document.body;this.tooltipOffsetX=t.get("tooltipOffsetX",10);this.tooltipOffsetY=t.get("tooltipOffsetY",12);n("#jqssizetip").remove();n("#jqstooltip").remove();this.sizetip=n("<div/>",{id:"jqssizetip",style:u,"class":r});this.tooltip=n("<div/>",{id:"jqstooltip","class":r}).appendTo(this.container);i=this.tooltip.offset();this.offsetLeft=i.left;this.offsetTop=i.top;this.hidden=!0;n(window).unbind("resize.jqs scroll.jqs");n(window).bind("resize.jqs scroll.jqs",n.proxy(this.updateWindowDims,this));this.updateWindowDims()},updateWindowDims:function(){this.scrollTop=n(window).scrollTop();this.scrollLeft=n(window).scrollLeft();this.scrollRight=this.scrollLeft+n(window).width();this.updatePosition()},getSize:function(n){this.sizetip.html(n).appendTo(this.container);this.width=this.sizetip.width()+1;this.height=this.sizetip.height();this.sizetip.remove()},setContent:function(n){if(!n){this.tooltip.css("visibility","hidden");this.hidden=!0;return}this.getSize(n);this.tooltip.html(n).css({width:this.width,height:this.height,visibility:"visible"});this.hidden&&(this.hidden=!1,this.updatePosition())},updatePosition:function(n,t){if(n===undefined){if(this.mousex===undefined)return;n=this.mousex-this.offsetLeft;t=this.mousey-this.offsetTop}else this.mousex=n=n-this.offsetLeft,this.mousey=t=t-this.offsetTop;this.height&&this.width&&!this.hidden&&(t-=this.height+this.tooltipOffsetY,n+=this.tooltipOffsetX,t<this.scrollTop&&(t=this.scrollTop),n<this.scrollLeft?n=this.scrollLeft:n+this.width>this.scrollRight&&(n=this.scrollRight-this.width),this.tooltip.css({left:n,top:t}))},remove:function(){this.tooltip.remove();this.sizetip.remove();this.sizetip=this.tooltip=undefined;n(window).unbind("resize.jqs scroll.jqs")}});ct=function(){tt(ht)};n(ct);i=[];n.fn.sparkline=function(t,r){return this.each(function(){var u=new n.fn.sparkline.options(this,r),o=n(this),e,f;if(e=function(){var e,c,s,r,i,h,f;if(t==="html"||t===undefined?(f=this.getAttribute(u.get("tagValuesAttribute")),(f===undefined||f===null)&&(f=o.html()),e=f.replace(/(^\s*<!--)|(-->\s*$)|\s+/g,"").split(",")):e=t,c=u.get("width")==="auto"?e.length*u.get("defaultPixelsPerValue"):u.get("width"),u.get("height")==="auto"?u.get("composite")&&n.data(this,"_jqs_vcanvas")||(r=document.createElement("span"),r.innerHTML="a",o.html(r),s=n(r).innerHeight()||n(r).height(),n(r).remove(),r=null):s=u.get("height"),u.get("disableInteraction")?i=!1:(i=n.data(this,"_jqs_mhandler"),i?u.get("composite")||i.reset():(i=new ut(this,u),n.data(this,"_jqs_mhandler",i))),u.get("composite")&&!n.data(this,"_jqs_vcanvas")){n.data(this,"_jqs_errnotify")||(alert("Attempted to attach a composite sparkline to an element with no existing sparkline"),n.data(this,"_jqs_errnotify",!0));return}h=new n.fn.sparkline[u.get("type")](this,e,u,c,s);h.render();i&&i.registerSparkline(h)},n(this).html()&&!u.get("disableHiddenCheck")&&n(this).is(":hidden")||!n(this).parents("body").length){if(!u.get("composite")&&n.data(this,"_jqs_pending"))for(f=i.length;f;f--)i[f-1][0]==this&&i.splice(f-1,1);i.push([this,e]);n.data(this,"_jqs_pending",!0)}else e.call(this)})};n.fn.sparkline.defaults=d();n.sparkline_display_visible=function(){for(var r,u=[],t=0,f=i.length;t<f;t++)r=i[t][0],n(r).is(":visible")&&!n(r).parents().is(":hidden")?(i[t][1].call(r),n.data(i[t][0],"_jqs_pending",!1),u.push(t)):n(r).closest("html").length||n.data(r,"_jqs_pending")||(n.data(i[t][0],"_jqs_pending",!1),u.push(t));for(t=u.length;t;t--)i.splice(u[t-1],1)};n.fn.sparkline.options=t({init:function(t,i){var e,r,u,f;this.userOptions=i=i||{};this.tag=t;this.tagValCache={};r=n.fn.sparkline.defaults;u=r.common;this.tagOptionsPrefix=i.enableTagOptions&&(i.tagOptionsPrefix||u.tagOptionsPrefix);f=this.getTagSetting("type");e=f===o?r[i.type||u.type]:r[f];this.mergedOptions=n.extend({},u,e,i)},getTagSetting:function(n){var r=this.tagOptionsPrefix,t,i,f,e;if(r===!1||r===undefined)return o;if(this.tagValCache.hasOwnProperty(n))t=this.tagValCache.key;else{if(t=this.tag.getAttribute(r+n),t===undefined||t===null)t=o;else if(t.substr(0,1)==="[")for(t=t.substr(1,t.length-2).split(","),i=t.length;i--;)t[i]=u(t[i].replace(/(^\s*)|(\s*$)/g,""));else if(t.substr(0,1)==="{")for(f=t.substr(1,t.length-2).split(","),t={},i=f.length;i--;)e=f[i].split(":",2),t[e[0].replace(/(^\s*)|(\s*$)/g,"")]=u(e[1].replace(/(^\s*)|(\s*$)/g,""));else t=u(t);this.tagValCache.key=t}return t},get:function(n,t){var i=this.getTagSetting(n),r;return i!==o?i:(r=this.mergedOptions[n])===undefined?t:r}});n.fn.sparkline._base=t({disabled:!1,init:function(t,i,r,u,f){this.el=t;this.$el=n(t);this.values=i;this.options=r;this.width=u;this.height=f;this.currentRegion=undefined},initTarget:function(){var n=!this.options.get("disableInteraction");(this.target=this.$el.simpledraw(this.width,this.height,this.options.get("composite"),n))?(this.canvasWidth=this.target.pixelWidth,this.canvasHeight=this.target.pixelHeight):this.disabled=!0},render:function(){return this.disabled?(this.el.innerHTML="",!1):!0},getRegion:function(){},setRegionHighlight:function(n,t,i){var u=this.currentRegion,f=!this.options.get("disableHighlight"),r;return t>this.canvasWidth||i>this.canvasHeight||t<0||i<0?null:(r=this.getRegion(n,t,i),u!==r)?(u!==undefined&&f&&this.removeHighlight(),this.currentRegion=r,r!==undefined&&f&&this.renderHighlight(),!0):!1},clearRegionHighlight:function(){return this.currentRegion!==undefined?(this.removeHighlight(),this.currentRegion=undefined,!0):!1},renderHighlight:function(){this.changeHighlight(!0)},removeHighlight:function(){this.changeHighlight(!1)},changeHighlight:function(){},getCurrentRegionTooltip:function(){var i=this.options,v="",s=[],t,e,y,p,w,u,h,c,l,b,a,o,k,f;if(this.currentRegion===undefined)return"";if(t=this.getCurrentRegionFields(),a=i.get("tooltipFormatter"),a)return a(this,i,t);if(i.get("tooltipChartTitle")&&(v+='<div class="jqs jqstitle">'+i.get("tooltipChartTitle")+"<\/div>\n"),e=this.options.get("tooltipFormat"),!e)return"";if(n.isArray(e)||(e=[e]),n.isArray(t)||(t=[t]),h=this.options.get("tooltipFormatFieldlist"),c=this.options.get("tooltipFormatFieldlistKey"),h&&c){for(l=[],u=t.length;u--;)b=t[u][c],(f=n.inArray(b,h))!=-1&&(l[f]=t[u]);t=l}for(y=e.length,k=t.length,u=0;u<y;u++)for(o=e[u],typeof o=="string"&&(o=new r(o)),p=o.fclass||"jqsfield",f=0;f<k;f++)t[f].isNull&&i.get("tooltipSkipNull")||(n.extend(t[f],{prefix:i.get("tooltipPrefix"),suffix:i.get("tooltipSuffix")}),w=o.render(t[f],i.get("tooltipValueLookups"),i),s.push('<div class="'+p+'">'+w+"<\/div>"));return s.length?v+s.join("\n"):""},getCurrentRegionFields:function(){},calcHighlightColor:function(n,t){var e=t.get("highlightColor"),o=t.get("highlightLighten"),r,s,u,i;if(e)return e;if(o&&(r=/^#([0-9a-f])([0-9a-f])([0-9a-f])$/i.exec(n)||/^#([0-9a-f]{2})([0-9a-f]{2})([0-9a-f]{2})$/i.exec(n),r)){for(u=[],s=n.length===4?16:1,i=0;i<3;i++)u[i]=f(Math.round(parseInt(r[i+1],16)*s*o),0,255);return"rgb("+u.join(",")+")"}return n}});h={changeHighlight:function(t){var r=this.currentRegion,f=this.target,u=this.regionShapes[r],i;u&&(i=this.renderRegion(r,t),n.isArray(i)||n.isArray(u)?(f.replaceWithShapes(u,i),this.regionShapes[r]=n.map(i,function(n){return n.id})):(f.replaceWithShape(u,i),this.regionShapes[r]=i.id))},render:function(){var e=this.values,o=this.target,u=this.regionShapes,t,f,i,r;if(this.cls._super.render.call(this)){for(i=e.length;i--;)if(t=this.renderRegion(i),t)if(n.isArray(t)){for(f=[],r=t.length;r--;)t[r].append(),f.push(t[r].id);u[i]=f}else t.append(),u[i]=t.id;else u[i]=null;o.render()}}};n.fn.sparkline.line=a=t(n.fn.sparkline._base,{type:"line",init:function(n,t,i,r,u){a._super.init.call(this,n,t,i,r,u);this.vertices=[];this.regionMap=[];this.xvalues=[];this.yvalues=[];this.yminmax=[];this.hightlightSpotId=null;this.lastShapeId=null;this.initTarget()},getRegion:function(n,t){for(var r=this.regionMap,i=r.length;i--;)if(r[i]!==null&&t>=r[i][0]&&t<=r[i][1])return r[i][2];return undefined},getCurrentRegionFields:function(){var n=this.currentRegion;return{isNull:this.yvalues[n]===null,x:this.xvalues[n],y:this.yvalues[n],color:this.options.get("lineColor"),fillColor:this.options.get("fillColor"),offset:n}},renderHighlight:function(){var s=this.currentRegion,t=this.target,n=this.vertices[s],i=this.options,f=i.get("spotRadius"),e=i.get("highlightSpotColor"),o=i.get("highlightLineColor"),r,u;n&&(f&&e&&(r=t.drawCircle(n[0],n[1],f,undefined,e),this.highlightSpotId=r.id,t.insertAfterShape(this.lastShapeId,r)),o&&(u=t.drawLine(n[0],this.canvasTop,n[0],this.canvasTop+this.canvasHeight,o),this.highlightLineId=u.id,t.insertAfterShape(this.lastShapeId,u)))},removeHighlight:function(){var n=this.target;this.highlightSpotId&&(n.removeShapeId(this.highlightSpotId),this.highlightSpotId=null);this.highlightLineId&&(n.removeShapeId(this.highlightLineId),this.highlightLineId=null)},scanValues:function(){for(var t=this.values,h=t.length,i=this.xvalues,f=this.yvalues,r=this.yminmax,u,o,s,e,n=0;n<h;n++)u=t[n],o=typeof t[n]=="string",s=typeof t[n]=="object"&&t[n]instanceof Array,e=o&&t[n].split(":"),o&&e.length===2?(i.push(Number(e[0])),f.push(Number(e[1])),r.push(Number(e[1]))):s?(i.push(u[0]),f.push(u[1]),r.push(u[1])):(i.push(n),t[n]===null||t[n]==="null"?f.push(null):(f.push(Number(u)),r.push(Number(u))));this.options.get("xvalues")&&(i=this.options.get("xvalues"));this.maxy=this.maxyorg=Math.max.apply(Math,r);this.miny=this.minyorg=Math.min.apply(Math,r);this.maxx=Math.max.apply(Math,i);this.minx=Math.min.apply(Math,i);this.xvalues=i;this.yvalues=f;this.yminmax=r},processRangeOptions:function(){var n=this.options,t=n.get("normalRangeMin"),i=n.get("normalRangeMax");t!==undefined&&(t<this.miny&&(this.miny=t),i>this.maxy&&(this.maxy=i));n.get("chartRangeMin")!==undefined&&(n.get("chartRangeClip")||n.get("chartRangeMin")<this.miny)&&(this.miny=n.get("chartRangeMin"));n.get("chartRangeMax")!==undefined&&(n.get("chartRangeClip")||n.get("chartRangeMax")>this.maxy)&&(this.maxy=n.get("chartRangeMax"));n.get("chartRangeMinX")!==undefined&&(n.get("chartRangeClipX")||n.get("chartRangeMinX")<this.minx)&&(this.minx=n.get("chartRangeMinX"));n.get("chartRangeMaxX")!==undefined&&(n.get("chartRangeClipX")||n.get("chartRangeMaxX")>this.maxx)&&(this.maxx=n.get("chartRangeMaxX"))},drawNormalRange:function(n,t,i,r,u){var e=this.options.get("normalRangeMin"),f=this.options.get("normalRangeMax"),o=t+Math.round(i-i*((f-this.miny)/u)),s=Math.round(i*(f-e)/u);this.target.drawRect(n,o,r,s,undefined,this.options.get("normalRangeColor")).append()},render:function(){var t=this.options,l=this.target,s=this.canvasWidth,f=this.canvasHeight,ct=this.vertices,r=t.get("spotRadius"),vt=this.regionMap,p,v,w,h,c,ot,u,it,k,b,lt,g,at,st,rt,ut,ft,et,d,nt,tt,ht,y,o,i;if(a._super.render.call(this)&&(this.scanValues(),this.processRangeOptions(),y=this.xvalues,o=this.yvalues,this.yminmax.length&&!(this.yvalues.length<2))){for(h=c=0,p=this.maxx-this.minx==0?1:this.maxx-this.minx,v=this.maxy-this.miny==0?1:this.maxy-this.miny,w=this.yvalues.length-1,r&&(s<r*4||f<r*4)&&(r=0),r&&(tt=t.get("highlightSpotColor")&&!t.get("disableInteraction"),(tt||t.get("minSpotColor")||t.get("spotColor")&&o[w]===this.miny)&&(f-=Math.ceil(r)),(tt||t.get("maxSpotColor")||t.get("spotColor")&&o[w]===this.maxy)&&(f-=Math.ceil(r),h+=Math.ceil(r)),(tt||(t.get("minSpotColor")||t.get("maxSpotColor"))&&(o[0]===this.miny||o[0]===this.maxy))&&(c+=Math.ceil(r),s-=Math.ceil(r)),(tt||t.get("spotColor")||t.get("minSpotColor")||t.get("maxSpotColor")&&(o[w]===this.miny||o[w]===this.maxy))&&(s-=Math.ceil(r))),f--,t.get("normalRangeMin")===undefined||t.get("drawNormalOnTop")||this.drawNormalRange(c,h,f,s,v),u=[],it=[u],st=rt=null,ut=o.length,i=0;i<ut;i++)k=y[i],lt=y[i+1],b=o[i],g=c+Math.round((k-this.minx)*(s/p)),at=i<ut-1?c+Math.round((lt-this.minx)*(s/p)):s,rt=g+(at-g)/2,vt[i]=[st||0,rt,i],st=rt,b===null?i&&(o[i-1]!==null&&(u=[],it.push(u)),ct.push(null)):(b<this.miny&&(b=this.miny),b>this.maxy&&(b=this.maxy),u.length||u.push([g,h+f]),ot=[g,h+Math.round(f-f*((b-this.miny)/v))],u.push(ot),ct.push(ot));for(ft=[],et=[],d=it.length,i=0;i<d;i++)u=it[i],u.length&&(t.get("fillColor")&&(u.push([u[u.length-1][0],h+f]),et.push(u.slice(0)),u.pop()),u.length>2&&(u[0]=[u[0][0],u[1][1]]),ft.push(u));for(d=et.length,i=0;i<d;i++)l.drawShape(et[i],t.get("fillColor"),t.get("fillColor")).append();for(t.get("normalRangeMin")!==undefined&&t.get("drawNormalOnTop")&&this.drawNormalRange(c,h,f,s,v),d=ft.length,i=0;i<d;i++)l.drawShape(ft[i],t.get("lineColor"),undefined,t.get("lineWidth")).append();if(r&&t.get("valueSpots"))for(nt=t.get("valueSpots"),nt.get===undefined&&(nt=new e(nt)),i=0;i<ut;i++)ht=nt.get(o[i]),ht&&l.drawCircle(c+Math.round((y[i]-this.minx)*(s/p)),h+Math.round(f-f*((o[i]-this.miny)/v)),r,undefined,ht).append();r&&t.get("spotColor")&&o[w]!==null&&l.drawCircle(c+Math.round((y[y.length-1]-this.minx)*(s/p)),h+Math.round(f-f*((o[w]-this.miny)/v)),r,undefined,t.get("spotColor")).append();this.maxy!==this.minyorg&&(r&&t.get("minSpotColor")&&(k=y[n.inArray(this.minyorg,o)],l.drawCircle(c+Math.round((k-this.minx)*(s/p)),h+Math.round(f-f*((this.minyorg-this.miny)/v)),r,undefined,t.get("minSpotColor")).append()),r&&t.get("maxSpotColor")&&(k=y[n.inArray(this.maxyorg,o)],l.drawCircle(c+Math.round((k-this.minx)*(s/p)),h+Math.round(f-f*((this.maxyorg-this.miny)/v)),r,undefined,t.get("maxSpotColor")).append()));this.lastShapeId=l.getLastShapeId();this.canvasTop=h;l.render()}}});n.fn.sparkline.bar=et=t(n.fn.sparkline._base,h,{type:"bar",init:function(t,i,r,o,s){var st=parseInt(r.get("barWidth"),10),ht=parseInt(r.get("barSpacing"),10),bt=r.get("chartRangeMin"),kt=r.get("chartRangeMax"),ct=r.get("chartRangeClip"),d=Infinity,b=-Infinity,lt,at,vt,nt,p,l,tt,yt,it,rt,a,v,pt,wt,y,ut,k,dt,gt,h,w,ni,ft,ot;for(et._super.init.call(this,t,i,r,o,s),l=0,tt=i.length;l<tt;l++)h=i[l],lt=typeof h=="string"&&h.indexOf(":")>-1,(lt||n.isArray(h))&&(y=!0,lt&&(h=i[l]=c(h.split(":"))),h=g(h,null),at=Math.min.apply(Math,h),vt=Math.max.apply(Math,h),at<d&&(d=at),vt>b&&(b=vt));for(this.stacked=y,this.regionShapes={},this.barWidth=st,this.barSpacing=ht,this.totalBarWidth=st+ht,this.width=o=i.length*st+(i.length-1)*ht,this.initTarget(),ct&&(pt=bt===undefined?-Infinity:bt,wt=kt===undefined?Infinity:kt),p=[],nt=y?[]:p,ft=[],ot=[],l=0,tt=i.length;l<tt;l++)if(y)for(ut=i[l],i[l]=gt=[],ft[l]=0,nt[l]=ot[l]=0,k=0,dt=ut.length;k<dt;k++)h=gt[k]=ct?f(ut[k],pt,wt):ut[k],h!==null&&(h>0&&(ft[l]+=h),d<0&&b>0?h<0?ot[l]+=Math.abs(h):nt[l]+=h:nt[l]+=Math.abs(h-(h<0?b:d)),p.push(h));else h=ct?f(i[l],pt,wt):i[l],h=i[l]=u(h),h!==null&&p.push(h);this.max=v=Math.max.apply(Math,p);this.min=a=Math.min.apply(Math,p);this.stackMax=b=y?Math.max.apply(Math,ft):v;this.stackMin=d=y?Math.min.apply(Math,p):a;r.get("chartRangeMin")!==undefined&&(r.get("chartRangeClip")||r.get("chartRangeMin")<a)&&(a=r.get("chartRangeMin"));r.get("chartRangeMax")!==undefined&&(r.get("chartRangeClip")||r.get("chartRangeMax")>v)&&(v=r.get("chartRangeMax"));this.zeroAxis=it=r.get("zeroAxis",!0);rt=a<=0&&v>=0&&it?0:it==!1?a:a>0?a:v;this.xaxisOffset=rt;yt=y?Math.max.apply(Math,nt)+Math.max.apply(Math,ot):v-a;this.canvasHeightEf=it&&a<0?this.canvasHeight-2:this.canvasHeight-1;a<rt?(ni=y&&v>=0?b:v,w=(ni-rt)/yt*this.canvasHeight,w!==Math.ceil(w)&&(this.canvasHeightEf-=2,w=Math.ceil(w))):w=this.canvasHeight;this.yoffset=w;n.isArray(r.get("colorMap"))?(this.colorMapByIndex=r.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=r.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===undefined&&(this.colorMapByValue=new e(this.colorMapByValue)));this.range=yt},getRegion:function(n,t){var i=Math.floor(t/this.totalBarWidth);return i<0||i>=this.values.length?undefined:i},getCurrentRegionFields:function(){for(var i=this.currentRegion,r=it(this.values[i]),u=[],n,t=r.length;t--;)n=r[t],u.push({isNull:n===null,value:n,color:this.calcColor(t,n,i),offset:i});return u},calcColor:function(t,i,r){var e=this.colorMapByIndex,o=this.colorMapByValue,f=this.options,u,s;return u=this.stacked?f.get("stackedBarColor"):i<0?f.get("negBarColor"):f.get("barColor"),i===0&&f.get("zeroColor")!==undefined&&(u=f.get("zeroColor")),o&&(s=o.get(i))?u=s:e&&e.length>r&&(u=e[r]),n.isArray(u)?u[t%u.length]:u},renderRegion:function(t,i){var r=this.values[t],o=this.options,s=this.xaxisOffset,v=[],p=this.range,tt=this.stacked,w=this.target,b=t*this.totalBarWidth,it=this.canvasHeightEf,f=this.yoffset,h,c,u,k,y,a,d,e,g,nt;if(r=n.isArray(r)?r:[r],d=r.length,e=r[0],k=l(null,r),nt=l(s,r,!0),k)return o.get("nullColor")?(u=i?o.get("nullColor"):this.calcHighlightColor(o.get("nullColor"),o),h=f>0?f-1:f,w.drawRect(b,h,this.barWidth-1,0,u,u)):undefined;for(y=f,a=0;a<d;a++){if(e=r[a],tt&&e===s){if(!nt||g)continue;g=!0}c=p>0?Math.floor(it*(Math.abs(e-s)/p))+1:1;e<s||e===s&&f===0?(h=y,y+=c):(h=f-c,f-=c);u=this.calcColor(a,e,t);i&&(u=this.calcHighlightColor(u,o));v.push(w.drawRect(b,h,this.barWidth-1,c-1,u,u))}return v.length===1?v[0]:v}});n.fn.sparkline.tristate=ot=t(n.fn.sparkline._base,h,{type:"tristate",init:function(t,i,r,u,f){var o=parseInt(r.get("barWidth"),10),s=parseInt(r.get("barSpacing"),10);ot._super.init.call(this,t,i,r,u,f);this.regionShapes={};this.barWidth=o;this.barSpacing=s;this.totalBarWidth=o+s;this.values=n.map(i,Number);this.width=u=i.length*o+(i.length-1)*s;n.isArray(r.get("colorMap"))?(this.colorMapByIndex=r.get("colorMap"),this.colorMapByValue=null):(this.colorMapByIndex=null,this.colorMapByValue=r.get("colorMap"),this.colorMapByValue&&this.colorMapByValue.get===undefined&&(this.colorMapByValue=new e(this.colorMapByValue)));this.initTarget()},getRegion:function(n,t){return Math.floor(t/this.totalBarWidth)},getCurrentRegionFields:function(){var n=this.currentRegion;return{isNull:this.values[n]===undefined,value:this.values[n],color:this.calcColor(this.values[n],n),offset:n}},calcColor:function(n,t){var u=this.values,i=this.options,r=this.colorMapByIndex,f=this.colorMapByValue,e;return f&&(e=f.get(n))?e:r&&r.length>t?r[t]:u[t]<0?i.get("negBarColor"):u[t]>0?i.get("posBarColor"):i.get("zeroBarColor")},renderRegion:function(n,t){var e=this.values,c=this.options,o=this.target,s,u,r,h,f,i;if(s=o.pixelHeight,r=Math.round(s/2),h=n*this.totalBarWidth,e[n]<0?(f=r,u=r-1):e[n]>0?(f=0,u=r-1):(f=r-1,u=2),i=this.calcColor(e[n],n),i!==null)return t&&(i=this.calcHighlightColor(i,c)),o.drawRect(h,f,this.barWidth-1,u-1,i,i)}});n.fn.sparkline.discrete=st=t(n.fn.sparkline._base,h,{type:"discrete",init:function(t,i,r,u,f){st._super.init.call(this,t,i,r,u,f);this.regionShapes={};this.values=i=n.map(i,Number);this.min=Math.min.apply(Math,i);this.max=Math.max.apply(Math,i);this.range=this.max-this.min;this.width=u=r.get("width")==="auto"?i.length*2:this.width;this.interval=Math.floor(u/i.length);this.itemWidth=u/i.length;r.get("chartRangeMin")!==undefined&&(r.get("chartRangeClip")||r.get("chartRangeMin")<this.min)&&(this.min=r.get("chartRangeMin"));r.get("chartRangeMax")!==undefined&&(r.get("chartRangeClip")||r.get("chartRangeMax")>this.max)&&(this.max=r.get("chartRangeMax"));this.initTarget();this.target&&(this.lineHeight=r.get("lineHeight")==="auto"?Math.round(this.canvasHeight*.3):r.get("lineHeight"))},getRegion:function(n,t){return Math.floor(t/this.itemWidth)},getCurrentRegionFields:function(){var n=this.currentRegion;return{isNull:this.values[n]===undefined,value:this.values[n],offset:n}},renderRegion:function(n,t){var l=this.values,i=this.options,s=this.min,a=this.max,v=this.range,y=this.interval,p=this.target,w=this.canvasHeight,h=this.lineHeight,c=w-h,u,e,r,o;return e=f(l[n],s,a),o=n*y,u=Math.round(c-c*((e-s)/v)),r=i.get("thresholdColor")&&e<i.get("thresholdValue")?i.get("thresholdColor"):i.get("lineColor"),t&&(r=this.calcHighlightColor(r,i)),p.drawLine(o,u,o,u+h,r)}});n.fn.sparkline.bullet=v=t(n.fn.sparkline._base,{type:"bullet",init:function(n,t,i,r,u){var e,o,f;v._super.init.call(this,n,t,i,r,u);this.values=t=c(t);f=t.slice();f[0]=f[0]===null?f[2]:f[0];f[1]=t[1]===null?f[2]:f[1];e=Math.min.apply(Math,t);o=Math.max.apply(Math,t);e=i.get("base")===undefined?e<0?e:0:i.get("base");this.min=e;this.max=o;this.range=o-e;this.shapes={};this.valueShapes={};this.regiondata={};this.width=r=i.get("width")==="auto"?"4.0em":r;this.target=this.$el.simpledraw(r,u,i.get("composite"));t.length||(this.disabled=!0);this.initTarget()},getRegion:function(n,t,i){var r=this.target.getShapeAt(n,t,i);return r!==undefined&&this.shapes[r]!==undefined?this.shapes[r]:undefined},getCurrentRegionFields:function(){var n=this.currentRegion;return{fieldkey:n.substr(0,1),value:this.values[n.substr(1)],region:n}},changeHighlight:function(n){var i=this.currentRegion,r=this.valueShapes[i],t;delete this.shapes[r];switch(i.substr(0,1)){case"r":t=this.renderRange(i.substr(1),n);break;case"p":t=this.renderPerformance(n);break;case"t":t=this.renderTarget(n)}this.valueShapes[i]=t.id;this.shapes[t.id]=i;this.target.replaceWithShape(r,t)},renderRange:function(n,t){var r=this.values[n],u=Math.round(this.canvasWidth*((r-this.min)/this.range)),i=this.options.get("rangeColors")[n-2];return t&&(i=this.calcHighlightColor(i,this.options)),this.target.drawRect(0,0,u-1,this.canvasHeight-1,i,i)},renderPerformance:function(n){var i=this.values[1],r=Math.round(this.canvasWidth*((i-this.min)/this.range)),t=this.options.get("performanceColor");return n&&(t=this.calcHighlightColor(t,this.options)),this.target.drawRect(0,Math.round(this.canvasHeight*.3),r-1,Math.round(this.canvasHeight*.4)-1,t,t)},renderTarget:function(n){var r=this.values[0],u=Math.round(this.canvasWidth*((r-this.min)/this.range)-this.options.get("targetWidth")/2),i=Math.round(this.canvasHeight*.1),f=this.canvasHeight-i*2,t=this.options.get("targetColor");return n&&(t=this.calcHighlightColor(t,this.options)),this.target.drawRect(u,i,this.options.get("targetWidth")-1,f-1,t,t)},render:function(){var i=this.values.length,r=this.target,t,n;if(v._super.render.call(this)){for(t=2;t<i;t++)n=this.renderRange(t).append(),this.shapes[n.id]="r"+t,this.valueShapes["r"+t]=n.id;this.values[1]!==null&&(n=this.renderPerformance().append(),this.shapes[n.id]="p1",this.valueShapes.p1=n.id);this.values[0]!==null&&(n=this.renderTarget().append(),this.shapes[n.id]="t0",this.valueShapes.t0=n.id);r.render()}}});n.fn.sparkline.pie=y=t(n.fn.sparkline._base,{type:"pie",init:function(t,i,r,u,f){var o=0,e;if(y._super.init.call(this,t,i,r,u,f),this.shapes={},this.valueShapes={},this.values=i=n.map(i,Number),r.get("width")==="auto"&&(this.width=this.height),i.length>0)for(e=i.length;e--;)o+=i[e];this.total=o;this.initTarget();this.radius=Math.floor(Math.min(this.canvasWidth,this.canvasHeight)/2)},getRegion:function(n,t,i){var r=this.target.getShapeAt(n,t,i);return r!==undefined&&this.shapes[r]!==undefined?this.shapes[r]:undefined},getCurrentRegionFields:function(){var n=this.currentRegion;return{isNull:this.values[n]===undefined,value:this.values[n],percent:this.values[n]/this.total*100,color:this.options.get("sliceColors")[n%this.options.get("sliceColors").length],offset:n}},changeHighlight:function(n){var t=this.currentRegion,i=this.renderSlice(t,n),r=this.valueShapes[t];delete this.shapes[r];this.target.replaceWithShape(r,i);this.valueShapes[t]=i.id;this.shapes[i.id]=t},renderSlice:function(n,t){for(var v=this.target,r=this.options,o=this.radius,y=r.get("borderWidth"),s=r.get("offset"),p=2*Math.PI,h=this.values,c=this.total,u=s?2*Math.PI*(s/360):0,l,f,e,a=h.length,i=0;i<a;i++){if(l=u,f=u,c>0&&(f=u+p*(h[i]/c)),n===i)return e=r.get("sliceColors")[i%r.get("sliceColors").length],t&&(e=this.calcHighlightColor(e,r)),v.drawPieSlice(o,o,o-y,l,f,undefined,e);u=f}},render:function(){var u=this.target,f=this.values,e=this.options,t=this.radius,i=e.get("borderWidth"),r,n;if(y._super.render.call(this)){for(i&&u.drawCircle(t,t,Math.floor(t-i/2),e.get("borderColor"),undefined,i).append(),n=f.length;n--;)f[n]&&(r=this.renderSlice(n).append(),this.valueShapes[n]=r.id,this.shapes[r.id]=n);u.render()}}});n.fn.sparkline.box=p=t(n.fn.sparkline._base,{type:"box",init:function(t,i,r,u,f){p._super.init.call(this,t,i,r,u,f);this.values=n.map(i,Number);this.width=r.get("width")==="auto"?"4.0em":u;this.initTarget();this.values.length||(this.disabled=1)},getRegion:function(){return 1},getCurrentRegionFields:function(){var n=[{field:"lq",value:this.quartiles[0]},{field:"med",value:this.quartiles[1]},{field:"uq",value:this.quartiles[2]}];return this.loutlier!==undefined&&n.push({field:"lo",value:this.loutlier}),this.routlier!==undefined&&n.push({field:"ro",value:this.routlier}),this.lwhisker!==undefined&&n.push({field:"lw",value:this.lwhisker}),this.rwhisker!==undefined&&n.push({field:"rw",value:this.rwhisker}),n},render:function(){var e=this.target,t=this.values,k=t.length,n=this.options,d=this.canvasWidth,i=this.canvasHeight,u=n.get("chartRangeMin")===undefined?Math.min.apply(Math,t):n.get("chartRangeMin"),nt=n.get("chartRangeMax")===undefined?Math.max.apply(Math,t):n.get("chartRangeMax"),f=0,o,y,g,c,v,l,h,w,a,b,r;if(p._super.render.call(this)){if(n.get("raw"))n.get("showOutliers")&&t.length>5?(y=t[0],o=t[1],c=t[2],v=t[3],l=t[4],h=t[5],w=t[6]):(o=t[0],c=t[1],v=t[2],l=t[3],h=t[4]);else if(t.sort(function(n,t){return n-t}),c=s(t,1),v=s(t,2),l=s(t,3),g=l-c,n.get("showOutliers")){for(o=h=undefined,a=0;a<k;a++)o===undefined&&t[a]>c-g*n.get("outlierIQR")&&(o=t[a]),t[a]<l+g*n.get("outlierIQR")&&(h=t[a]);y=t[0];w=t[k-1]}else o=t[0],h=t[k-1];this.quartiles=[c,v,l];this.lwhisker=o;this.rwhisker=h;this.loutlier=y;this.routlier=w;r=d/(nt-u+1);n.get("showOutliers")&&(f=Math.ceil(n.get("spotRadius")),d-=2*Math.ceil(n.get("spotRadius")),r=d/(nt-u+1),y<o&&e.drawCircle((y-u)*r+f,i/2,n.get("spotRadius"),n.get("outlierLineColor"),n.get("outlierFillColor")).append(),w>h&&e.drawCircle((w-u)*r+f,i/2,n.get("spotRadius"),n.get("outlierLineColor"),n.get("outlierFillColor")).append());e.drawRect(Math.round((c-u)*r+f),Math.round(i*.1),Math.round((l-c)*r),Math.round(i*.8),n.get("boxLineColor"),n.get("boxFillColor")).append();e.drawLine(Math.round((o-u)*r+f),Math.round(i/2),Math.round((c-u)*r+f),Math.round(i/2),n.get("lineColor")).append();e.drawLine(Math.round((o-u)*r+f),Math.round(i/4),Math.round((o-u)*r+f),Math.round(i-i/4),n.get("whiskerColor")).append();e.drawLine(Math.round((h-u)*r+f),Math.round(i/2),Math.round((l-u)*r+f),Math.round(i/2),n.get("lineColor")).append();e.drawLine(Math.round((h-u)*r+f),Math.round(i/4),Math.round((h-u)*r+f),Math.round(i-i/4),n.get("whiskerColor")).append();e.drawLine(Math.round((v-u)*r+f),Math.round(i*.1),Math.round((v-u)*r+f),Math.round(i*.9),n.get("medianColor")).append();n.get("target")&&(b=Math.ceil(n.get("spotRadius")),e.drawLine(Math.round((n.get("target")-u)*r+f),Math.round(i/2-b),Math.round((n.get("target")-u)*r+f),Math.round(i/2+b),n.get("targetColor")).append(),e.drawLine(Math.round((n.get("target")-u)*r+f-b),Math.round(i/2),Math.round((n.get("target")-u)*r+f+b),Math.round(i/2),n.get("targetColor")).append());e.render()}}});lt=t({init:function(n,t,i,r){this.target=n;this.id=t;this.type=i;this.args=r},append:function(){return this.target.appendShape(this),this}});w=t({_pxregex:/(\d+)(px)?\s*$/i,init:function(t,i,r){t&&(this.width=t,this.height=i,this.target=r,this.lastShapeId=null,r[0]&&(r=r[0]),n.data(r,"_jqs_vcanvas",this))},drawLine:function(n,t,i,r,u,f){return this.drawShape([[n,t],[i,r]],u,f)},drawShape:function(n,t,i,r){return this._genShape("Shape",[n,t,i,r])},drawCircle:function(n,t,i,r,u,f){return this._genShape("Circle",[n,t,i,r,u,f])},drawPieSlice:function(n,t,i,r,u,f,e){return this._genShape("PieSlice",[n,t,i,r,u,f,e])},drawRect:function(n,t,i,r,u,f){return this._genShape("Rect",[n,t,i,r,u,f])},getElement:function(){return this.canvas},getLastShapeId:function(){return this.lastShapeId},reset:function(){alert("reset not implemented")},_insert:function(t,i){n(i).html(t)},_calculatePixelDims:function(t,i,r){var u;u=this._pxregex.exec(i);this.pixelHeight=u?u[1]:n(r).height();u=this._pxregex.exec(t);this.pixelWidth=u?u[1]:n(r).width()},_genShape:function(n,t){var i=vt++;return t.unshift(i),new lt(this,i,n,t)},appendShape:function(){alert("appendShape not implemented")},replaceWithShape:function(){alert("replaceWithShape not implemented")},insertAfterShape:function(){alert("insertAfterShape not implemented")},removeShapeId:function(){alert("removeShapeId not implemented")},getShapeAt:function(){alert("getShapeAt not implemented")},render:function(){alert("render not implemented")}});b=t(w,{init:function(t,i,r,u){b._super.init.call(this,t,i,r);this.canvas=document.createElement("canvas");r[0]&&(r=r[0]);n.data(r,"_jqs_vcanvas",this);n(this.canvas).css({display:"inline-block",width:t,height:i,verticalAlign:"top"});this._insert(this.canvas,r);this._calculatePixelDims(t,i,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;this.interact=u;this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined;n(this.canvas).css({width:this.pixelWidth,height:this.pixelHeight})},_getContext:function(n,t,i){var r=this.canvas.getContext("2d");return n!==undefined&&(r.strokeStyle=n),r.lineWidth=i===undefined?1:i,t!==undefined&&(r.fillStyle=t),r},reset:function(){var n=this._getContext();n.clearRect(0,0,this.pixelWidth,this.pixelHeight);this.shapes={};this.shapeseq=[];this.currentTargetShapeId=undefined},_drawShape:function(n,t,i,r,u){var f=this._getContext(i,r,u),e,o;for(f.beginPath(),f.moveTo(t[0][0]+.5,t[0][1]+.5),e=1,o=t.length;e<o;e++)f.lineTo(t[e][0]+.5,t[e][1]+.5);i!==undefined&&f.stroke();r!==undefined&&f.fill();this.targetX!==undefined&&this.targetY!==undefined&&f.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=n)},_drawCircle:function(n,t,i,r,u,f,e){var o=this._getContext(u,f,e);o.beginPath();o.arc(t,i,r,0,2*Math.PI,!1);this.targetX!==undefined&&this.targetY!==undefined&&o.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=n);u!==undefined&&o.stroke();f!==undefined&&o.fill()},_drawPieSlice:function(n,t,i,r,u,f,e,o){var s=this._getContext(e,o);s.beginPath();s.moveTo(t,i);s.arc(t,i,r,u,f,!1);s.lineTo(t,i);s.closePath();e!==undefined&&s.stroke();o&&s.fill();this.targetX!==undefined&&this.targetY!==undefined&&s.isPointInPath(this.targetX,this.targetY)&&(this.currentTargetShapeId=n)},_drawRect:function(n,t,i,r,u,f,e){return this._drawShape(n,[[t,i],[t+r,i],[t+r,i+u],[t,i+u],[t,i]],f,e)},appendShape:function(n){return this.shapes[n.id]=n,this.shapeseq.push(n.id),this.lastShapeId=n.id,n.id},replaceWithShape:function(n,t){var r=this.shapeseq,i;for(this.shapes[t.id]=t,i=r.length;i--;)r[i]==n&&(r[i]=t.id);delete this.shapes[n]},replaceWithShapes:function(n,t){for(var r=this.shapeseq,f={},u,e,i=n.length;i--;)f[n[i]]=!0;for(i=r.length;i--;)u=r[i],f[u]&&(r.splice(i,1),delete this.shapes[u],e=i);for(i=t.length;i--;)r.splice(e,0,t[i].id),this.shapes[t[i].id]=t[i]},insertAfterShape:function(n,t){for(var r=this.shapeseq,i=r.length;i--;)if(r[i]===n){r.splice(i+1,0,t.id);this.shapes[t.id]=t;return}},removeShapeId:function(n){for(var i=this.shapeseq,t=i.length;t--;)if(i[t]===n){i.splice(t,1);break}delete this.shapes[n]},getShapeAt:function(n,t,i){return this.targetX=t,this.targetY=i,this.render(),this.currentTargetShapeId},render:function(){var i=this.shapeseq,u=this.shapes,f=i.length,e=this._getContext(),r,t,n;for(e.clearRect(0,0,this.pixelWidth,this.pixelHeight),n=0;n<f;n++)r=i[n],t=u[r],this["_draw"+t.type].apply(this,t.args);this.interact||(this.shapes={},this.shapeseq=[])}});k=t(w,{init:function(t,i,r){var u;k._super.init.call(this,t,i,r);r[0]&&(r=r[0]);n.data(r,"_jqs_vcanvas",this);this.canvas=document.createElement("span");n(this.canvas).css({display:"inline-block",position:"relative",overflow:"hidden",width:t,height:i,margin:"0px",padding:"0px",verticalAlign:"top"});this._insert(this.canvas,r);this._calculatePixelDims(t,i,this.canvas);this.canvas.width=this.pixelWidth;this.canvas.height=this.pixelHeight;u='<v:group coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'" style="position:absolute;top:0;left:0;width:'+this.pixelWidth+"px;height="+this.pixelHeight+'px;"><\/v:group>';this.canvas.insertAdjacentHTML("beforeEnd",u);this.group=n(this.canvas).children()[0];this.rendered=!1;this.prerender=""},_drawShape:function(n,t,i,r,u){for(var f=[],o,s,h,c,e=0,l=t.length;e<l;e++)f[e]=""+t[e][0]+","+t[e][1];return o=f.splice(0,1),u=u===undefined?1:u,s=i===undefined?' stroked="false" ':' strokeWeight="'+u+'px" strokeColor="'+i+'" ',h=r===undefined?' filled="false"':' fillColor="'+r+'" filled="true" ',c=f[0]===f[f.length-1]?"x ":"",'<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+n+'" '+s+h+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+o+" l "+f.join(", ")+" "+c+'e"> <\/v:shape>'},_drawCircle:function(n,t,i,r,u,f,e){var o,s;return t-=r,i-=r,o=u===undefined?' stroked="false" ':' strokeWeight="'+e+'px" strokeColor="'+u+'" ',s=f===undefined?' filled="false"':' fillColor="'+f+'" filled="true" ','<v:oval  id="jqsshape'+n+'" '+o+s+' style="position:absolute;top:'+i+"px; left:"+t+"px; width:"+r*2+"px; height:"+r*2+'px"><\/v:oval>'},_drawPieSlice:function(n,t,i,r,u,f,e,o){var a,s,h,c,l,v,y;if(u===f)return"";if(f-u==2*Math.PI&&(u=0,f=2*Math.PI),s=t+Math.round(Math.cos(u)*r),h=i+Math.round(Math.sin(u)*r),c=t+Math.round(Math.cos(f)*r),l=i+Math.round(Math.sin(f)*r),s===c&&h===l){if(f-u<Math.PI)return"";s=c=t+r;h=l=i}return s===c&&h===l&&f-u<Math.PI?"":(a=[t-r,i-r,t+r,i+r,s,h,c,l],v=e===undefined?' stroked="false" ':' strokeWeight="1px" strokeColor="'+e+'" ',y=o===undefined?' filled="false"':' fillColor="'+o+'" filled="true" ','<v:shape coordorigin="0 0" coordsize="'+this.pixelWidth+" "+this.pixelHeight+'"  id="jqsshape'+n+'" '+v+y+' style="position:absolute;left:0px;top:0px;height:'+this.pixelHeight+"px;width:"+this.pixelWidth+'px;padding:0px;margin:0px;"  path="m '+t+","+i+" wa "+a.join(", ")+' x e"> <\/v:shape>')},_drawRect:function(n,t,i,r,u,f,e){return this._drawShape(n,[[t,i],[t,i+u],[t+r,i+u],[t+r,i],[t,i]],f,e)},reset:function(){this.group.innerHTML=""},appendShape:function(n){var t=this["_draw"+n.type].apply(this,n.args);return this.rendered?this.group.insertAdjacentHTML("beforeEnd",t):this.prerender+=t,this.lastShapeId=n.id,n.id},replaceWithShape:function(t,i){var r=n("#jqsshape"+t),u=this["_draw"+i.type].apply(this,i.args);r[0].outerHTML=u},replaceWithShapes:function(t,i){for(var f=n("#jqsshape"+t[0]),u="",e=i.length,r=0;r<e;r++)u+=this["_draw"+i[r].type].apply(this,i[r].args);for(f[0].outerHTML=u,r=1;r<t.length;r++)n("#jqsshape"+t[r]).remove()},insertAfterShape:function(t,i){var r=n("#jqsshape"+t),u=this["_draw"+i.type].apply(this,i.args);r[0].insertAdjacentHTML("afterEnd",u)},removeShapeId:function(t){var i=n("#jqsshape"+t);this.group.removeChild(i[0])},getShapeAt:function(n){return n.id.substr(8)},render:function(){this.rendered||(this.group.innerHTML=this.prerender,this.rendered=!0)}})})(window.jQuery)});