{extend name="layouts@base" /}
{block name="head"}
<link rel="stylesheet" href="__STATIC__/mobile/default/css/generalize.css" />
{/block}
{block name='pageType'}myCode{/block}
{block name="main" }
<div class="page-bd ">
    <!-- 页面内容-->
        <div class="tabBox" id="capture">
          <div class="block">        
            <div class="one">
              <img src="{:settings('share_bg')}" alt="" class="goodsimg">
              <div class="info">
                <div class="left">
                  <img src="{:settings('share_bg')}" alt="">
                  <div>
                    <p class="fs34 color_0 fw_b">{$userInfo['nick_name']}</p>
                    <span class="fs26 color_9">{$userInfo['signature']}</span>
                  </div>
                </div>
                <div class="right">
                    <img src="" class="code" alt="">
                </div>
              </div>
            </div>
          </div>
          <div class="block box">
              <div class="two">
                <div class="info">
                    <div class="left">
                      <img src="__STATIC__/mobile/default/images/seckillimg.png" alt="">
                      <div>
                        <p class="fs34 color_0 fw_b">{$userInfo['nick_name']}</p>
                        <span class="fs26 color_9">{$userInfo['signature']}</span>
                      </div>
                    </div>
                </div>
                <img src="{:settings('share_bg')}" alt="" class="goodsimg">
                <div class="right">
                    <img src="" class="code" alt="">
                </div>
              </div>
              
          </div>
          <div class="block box">
            <div class="three">
              <div class="info">
                <img src="__STATIC__/mobile/default/images/seckillimg.png" alt="">
                <p class="fs34 color_0 fw_b">{$userInfo['nick_name']}</p>
                <span class="fs26 color_9">{$userInfo['signature']}</span>
              </div>
              <img src="{:settings('share_bg')}" alt="" class="goodsimg">
              <div class="right">
                  <img src="" class="code" alt="">
              </div>
            </div>
          </div>
        </div>
        <div class="tab">
          <div class="tablist"><img src="__STATIC__/mobile/default/images/mycode02.png" alt=""></div>
          <div class="tablist boxOpacity"><img src="__STATIC__/mobile/default/images/mycode04.png" alt=""></div>
          <div class="tablist boxOpacity"><img src="__STATIC__/mobile/default/images/mycode03.png" alt=""></div>
        </div>

    </div>
    <div class="page-ft">
      <div class="BGcolor_3 saveImg"><img src="__STATIC__/mobile/default/images/goodsIcon04.png" alt=""><span class="fs28 fw_b color_w">保存图片</span></div>
      <div class="BGcolor_3 copy"><img src="__STATIC__/mobile/default/images/myCode01.png" alt=""><span class="fs28 fw_b color_w">复制链接</span></div>
      <div class="BGcolor_3"><img src="__STATIC__/mobile/default/images/myCode05.png" alt=""><span class="fs28 fw_b color_w">分享链接</span></div>
    </div>

</div>
{/block}

{block name="footer"}
<script type="text/javascript" src="https://cdn.bootcss.com/html2canvas/0.5.0-beta4/html2canvas.js"></script>
<script>
$(function(){
   $('.tablist').on('click',function(){
	 let index=$(this).index()
	 $(this).removeClass('boxOpacity')
	 $(this).siblings().addClass('boxOpacity')
	 $('.block').eq(index).removeClass('box')
	 $('.block').eq(index).siblings().addClass('box')
   })
   //保存图片
   $('.saveImg').click(function(){
		html2canvas(document.querySelector("#capture")).then(canvas => {
			window.location.href = canvas.toDataURL();
		});
	})
	 //复制
   $('.copy').click(function(){
		copyTextToClipboard('{$userInfo["shareUrl"]}')
	})
   //获取二维码
   jq_ajax('{:url("member/api.users/myCode")}','',function(res){
	   if (res.code == 0){
			_alert(res.msg);
			return false;   
	   }
	   $('.code').attr('src',res.file);
	});
})


  function copyTextToClipboard(text) {
    var textArea = document.createElement("textarea")

    textArea.style.position = 'fixed'
    textArea.style.top = 0
    textArea.style.left = 0
    textArea.style.width = '2em'
    textArea.style.height = '2em'
    textArea.style.padding = 0
    textArea.style.border = 'none'
    textArea.style.outline = 'none'
    textArea.style.boxShadow = 'none'
    textArea.style.background = 'transparent'
    textArea.value = text

    document.body.appendChild(textArea)

    textArea.select()

    try {
      var msg = document.execCommand('copy') ? '成功' : '失败'
      alert('复制内容 ' + msg);
    } catch (err) {
      alert('不能使用这种方法复制内容');
    }

    document.body.removeChild(textArea)
}
</script>

{/block}