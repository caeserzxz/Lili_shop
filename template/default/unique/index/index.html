{extend name="layouts@base_unique" /}
{block name="main" }
<link rel="stylesheet" href="__STATIC__/unique/js/Swiper-4.0.7/swiper.min.css" />
<link rel="stylesheet" href="__STATIC__/unique/css/index.css" />
<link rel="stylesheet" href="__STATIC__/unique/css/coupons.css" />

    <div class="page">
        <div class="page-hd"></div>

        <div class="page-bd">
            <!-- 页面内容-->
            <div class="selectBox">
                <img class="headimg" src="__STATIC__/unique/images/shareCircle07.png" alt="" />
                <a href="{:url('unique/index/region')}" class="fs28 fw_b addr">{$city_info.short_name}</a>
                <a href="{:url('unique/index/search')}" class="selech">
                    <img src="__STATIC__/unique/images/selech01.png" alt="" />
                    <span class="fs30 color_9">搜索店铺</span>
                </a>
                <a href="#" class="sao_icon">
                    <img src="__STATIC__/unique/images/sao_icon.png" alt="" />
                </a>
            </div>
            <div class="swiperGird" style="">
                <!--<div class="swiper-container swiper1" id="swiper01">-->
                    <!--<div class="swiper-wrapper">-->
                        <!--<a href="#" class="swiper-slide"><img data-src="__STATIC__/unique/images/swiperimg01.png"-->
                                <!--class="swiper-lazy" />-->
                            <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
                        <!--</a>-->
                        <!--<a href="#" class="swiper-slide"><img data-src="__STATIC__/unique/images/swiperimg01.png"-->
                                <!--class="swiper-lazy" />-->
                            <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
                        <!--</a>-->
                        <!--<a href="#" class="swiper-slide"><img data-src="__STATIC__/unique/images/swiperimg01.png"-->
                                <!--class="swiper-lazy" />-->
                            <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
                        <!--</a>-->
                        <!--<a href="#" class="swiper-slide">-->
                            <!--<img data-src="__STATIC__/unique/images/swiperimg01.png" class="swiper-lazy" />-->
                            <!--<div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>-->
                        <!--</a>-->
                    <!--</div>-->
                    <!--<div class="swiper-pagination pagination1"></div>-->
                <!--</div>-->
                <div class="swiper-container swiper1" id="swiper01">
                    <div class="swiper-wrapper">
                        {volist name="slideList" id="slide" }
                        <a href="{$slide.url}" class="swiper-slide" data-bg_color="{$slide.bg_color}">
                            <img data-src="{$slide.imgurl}" class="swiper-lazy">
                            <div class="swiper-lazy-preloader swiper-lazy-preloader-white"></div>
                        </a>
                        {/volist}
                    </div>
                    <div class="swiper-pagination pagination1"></div>
                </div>
                <!-- 功能入口 -->
                <div class="girdBox">
                    <div class="bannerBox">
                        <div class="bannerSwiper">
                            <img src="__STATIC__/unique/images/index_icon09.png" alt="" />
                            <div class="swiper-container swiper2" id="swiper02">
                                <div class="swiper-wrapper">
                                    {volist name="headline" id="hl" }
                                     <a href="{:url('shop/article/headline')}" class="swiper-slide">{$hl.title}</a>
                                    {/volist}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="gird">
                        <div class="scrllBox" id="tab1">
                            <script type="text/html" id="listTpl1">
                                {{each list as item index}}
                                <a href="#" class="box">
                                    <div>
                                        <img src="{{item.pic}}" alt="" />
                                    </div>
                                    <span class="fs26 color_3">{{item.name}}</span>
                                </a>
                                {{/each}}
                            </script>

                            <a href="#" class="box" onclick="showCategory('show')">
                                <div>
                                    <img src="__STATIC__/unique/images/index_icon05.png" alt="" />
                                </div>
                                <span class="fs26 color_3">更多分类</span>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <!-- 更多分类 弹窗 -->
            <div class="modal-category">
                <div class="more-main">

                    <div class="cate-list" id="tab2">
                        <script type="text/html" id="listTpl2">
                            {{each list as item index}}
                                <div class="list-item">
                                    <div class="title fs30 fw_b">{{item.name}}</div>
                                    <div class="sub-list">
                                        {{each item.list as v k}}
                                        <a class="sub-item">
                                            <img src="{{v.pic}}" alt="">
                                            <p class="fs26">{{v.name}}</p>
                                        </a>
                                        {{/each}}
                                    </div>
                                </div>
                            {{/each}}
                        </script>
                    </div>

                    <div class="footer-btn">
                        <span onclick="showCategory('hide')">点击收起</span>
                    </div>

                </div>

            </div>
            <!-- 附近商家 -->
            <div class="nearShop">
                <div class="title">附近商家</div>
                <div class="shop-list" id="tab3">
                    <script type="text/html" id="listTpl3">
                        {{each list as item index}}
                            <div class="list-item">
                                <img class="shop-img" src="{{item.logo}}" alt="" />
                                <div class="shop-info">
                                    <div class="shop-name fs28 fw_b col_3">{{item.business_name}}</div>
                                    <div class="shop-addr fs23 color_9">{{item.address}}</div>

                                    <div class="shop-label">
                                        {{each item.label_arr as v k}}
                                            <span>{{v}}</span>
                                        {{/each}}
                                    </div>
                                    <div class="shop-enc">
                                        <span>鼓励金:{{item.hearten}}%</span>
                                    </div>
                                </div>
                                <div class="shop-distance">
                                    <div class="text_c color_9">{{item.distance}}</div>
                                    <div>
                                        <img class="red-env" src="__STATIC__/unique/images/red_env.png" alt="">
                                    </div>
                                </div>
                            </div>
                        {{/each}}
                    </script>
                    <!--<div class="list-item">-->
                        <!--<img class="shop-img" src="__STATIC__/unique/images/seckillimg.png" alt="" />-->
                        <!--<div class="shop-info">-->
                            <!--<div class="shop-name fs28 fw_b col_3">全家士多便利店</div>-->
                            <!--<div class="shop-addr fs23 color_9">广州市天河区棠东毓敏东路12号</div>-->
                            <!--<div class="shop-label">-->
                                <!--<span>便利店</span>-->
                                <!--<span>优惠多</span>-->
                                <!--<span>种类齐全</span>-->
                            <!--</div>-->
                            <!--<div class="shop-enc">-->
                                <!--<span>鼓励金:8%</span>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="shop-distance">-->
                            <!--<div class="text_c color_9">613m</div>-->
                            <!--<div>-->
                                <!--<img class="red-env" src="__STATIC__/unique/images/red_env.png" alt="">-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                    <!--<div class="list-item">-->
                        <!--<img class="shop-img" src="__STATIC__/unique/images/seckillimg.png" alt="" />-->
                        <!--<div class="shop-info">-->
                            <!--<div class="shop-name fs28 fw_b col_3">全家士多便利店</div>-->
                            <!--<div class="shop-addr fs23 color_9">广州市天河区棠东毓敏东路12号</div>-->
                            <!--<div class="shop-label">-->
                                <!--<span>便利店</span>-->
                                <!--<span>优惠多</span>-->
                                <!--<span>种类齐全</span>-->
                            <!--</div>-->
                            <!--<div class="shop-enc">-->
                                <!--<span>鼓励金:8%</span>-->
                            <!--</div>-->
                        <!--</div>-->
                        <!--<div class="shop-distance">-->
                            <!--<div class="text_c color_9">613m</div>-->
                            <!--<div>-->
                                <!--<img class="red-env" src="__STATIC__/unique/images/red_env.png" alt="">-->
                            <!--</div>-->
                        <!--</div>-->
                    <!--</div>-->
                </div>
            </div>
        </div>
        {include file="layouts@bottom_unique" /}
    </div>
{/block}
{block name="footer"}

<script>
    $(function() {
        FastClick.attach(document.body);
    });
</script>
<script src="__STATIC__/unique/js/Swiper-4.0.7/swiper.min.js"></script>
    <script>
        $(function () {
            var apptype = "{$apptype}";
            var input_city = "{$city}";
            if (input_city == '') {
                if (apptype == 'Android') {
                    window.auc.getLocBySDK();
                }else {
                    GetLocCallBack("{$city_info.lat}", "{$city_info.lng}");
                }
            }else {
                GetLocCallBack("{$city_info.lat}", "{$city_info.lng}");
            }

            get_recommend_class();
            get_class();

            var swiper1 = createSwiper(1, "horizontal", 4000, "fraction");
            var swiper2 = createSwiper(2, "vertical", 5000, "bullets");
        });

        //sdk 回调wxLoginCallback函数
        function GetLocCallBack(lat,lng){
            var arr = new Object();
            arr.lat = lat;
            arr.lng = lng;
            jq_ajax("{:url('unique/api.business/index')}",arr,function (res) {
                $('#city').text(res.city);
                $('#address').text(res.address);
                //提交ajax
                var arr = new Object();
                arr.city = window.city = res.city_id;
                arr.page = window.page = 0;
                arr.latitude  = window.lat = lat;
                arr.longitude  = window.lng = lng;
                getList(arr);
            });
        }

        function createSwiper(index, _direction, time, type) {
            var swiper = new Swiper(".swiper" + index, {
                pagination: {
                    el: ".pagination" + index,
                    type: type
                },
                lazy: {
                    loadPrevNext: true,
                },
                direction: _direction,
                preloadImages: false,
                paginationClickable: true,
                loop: true,
                autoplay: {
                    delay: time,
                    disableOnInteraction: false
                },
                onSlideChangeEnd: function (swiper) {
                    swiper.update(); //swiper更新
                },
                on: {
                    slideChangeTransitionStart: function(){
                        if(index==1){
                            var bg_color = $('#swiper01').find('a').eq(this.activeIndex).data('bg_color');
                            $('.swiperGird').css('background-color',bg_color);
                        }
                    },
                },
            });
            return swiper;
        }
        // 当用户滚动到页面底部的时候加载更多内容。
        $('.page-bd').infinite(100);
        var loading = false;  //状态标记
        $('.page-bd').infinite().on("infinite", function() {
            if(loading) return;
            // loading = true;
            // 请求数据

            // setTimeout(function() {
            //     $(".shop-list").append("<p> 我是新加载的内容 </p>");
            //     loading = false;
            // }, 1500);   //模拟延迟
        })

        function getList(arr){
            console.log(arr);
            $.ajax({
                url:'{:url("unique/api.business/getList")}',// 跳转到 action
                data:arr,
                type:'post',
                cache:false,
                async: false,
                dataType:'json',
                success:function(res) {
                    console.log(res)
                    if (res.list.length > 0) {
                        $('#tab3').prepend(template('listTpl3',res));
                        window.page += 1;
                    }else{
                        $.toast('加载完成',"text");
                    }
                    // if(res.info != ''){
                    //     info = res.info;
                    //     html = '';
                    //     for(x in info) {
                    //         html += '<div class="weui-cells"><div class="weui-cell"><div class="weui-cell__hd"><img class="top_image" src="'+info[x]['supplyer_img']+'"></div><div class="weui-cell__bd"><p class="fs30 color_o ">'+info[x]['supplyer_name']+'</p><p class="fs24 color_6 ">电话：'+info[x]['moblie']+'</p><p class="fs24 color_6 adress">地址：'+info[x]['merger_name']+info[x]['address']+'</p></div><div class="weui-cell__ft fs24 h color_6">'+info[x]['distance']+'</div></div><img class="content_img" src="'+info[x]['supplyer_album']+'" alt=""><p class="fs24 color_r oneMore" data-id="'+info[x]['supplyer_id']+'">点击查看详情 >></p></div>';
                    //     }
                    //
                    //     $('.region_n').append(html);
                    //
                    //     $('.color_r').on('click',function(){
                    //         var id = $(this).data('id');
                    //         window.location.href = "{:url('store/activity/goods')}?id="+id;
                    //     });
                    //
                    //     window.page += 1;
                    // }
                },error : function(res) {
                    $.toast(res.msg);
                }
            });
        }

        // 显示隐藏  分类弹窗
        function showCategory(type) {

            if (type === 'show') {
                $('.modal-category').fadeToggle(200, function () {
                    $('.modal-category .more-main').slideToggle(300)
                })
            } else if (type === 'hide') {
                $('.modal-category .more-main').slideToggle(300, function() {
                    $('.modal-category').fadeToggle(200)
                })
            }
        }

        //获取推荐分类
        function get_recommend_class(){
            $.ajax({
                'url':'{:url("unique/api.index/get_recommend_class")}',
                'type':'post',
                'data':'',
                'dataType':'json',
                'success':function(res){
                    console.log(res);
                    if (res.list.length > 0) {
                        $('#tab1').prepend(template('listTpl1',res));
                    }else{
                        $.toast('加载完成',"text");
                    }
                }
            });
        }
        //获取所有分类
        function get_class(){
            $.ajax({
                'url':'{:url("unique/api.index/get_class")}',
                'type':'post',
                'data':'',
                'dataType':'json',
                'success':function(res){
                    if (res.list.length > 0) {
                        $('#tab2').prepend(template('listTpl2',res));
                    }else{
                        $.toast('加载完成',"text");
                    }
                }
            });
        }
    </script>
</body>

</html>
{/block}