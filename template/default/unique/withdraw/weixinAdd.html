{extend name="layouts@base" /}
{block name="head"}
<link rel="stylesheet" href="__STATIC__/unique/css/userData.css"/>
<link rel="stylesheet" href="__STATIC__/unique/css/orderDetails.css" />
{/block}

{block name="main" }
<form id="alipay_from">
<div class="page-bd addType">
  <!-- 页面内容-->
    <div class="tab fs32">
        <div class="color_9"><a href="{:url('bankAdd')}">银行卡</a></div>
        <div class="color_9"><a href="{:url('alipayAdd')}">支付宝</a></div>
        <div class="color_9 active"><a href="javascript:;">微信</a></div>
    </div>
    <div class="cells" id="file_box">
      <div class="uploading">
          <div class="title fs32 fw_b color_3">上传收款二维码</div>
          <div class="uploadBox" >
              <div class="Box" id="upload_qrcode_box">
                  <img src="__STATIC__/mobile/default/images/addImg.png" alt="" class="imgBox">
                  <input type="file" class="uploadInput" >
              </div>
              <div></div>
          </div>
      </div>
    </div>
    <div class="cells">
        <div class="cell">
            <div class="cell_bd">
                <span class="fs28 fw_b color_3">是否设为默认收款方式</span></div>
            <div class="cell_ft">
                <input type="checkbox" name="is_default" id="is_default" value="1" class="chooseBtn" />
                <label for="is_default" class="choose-label"></label>
            </div>
        </div>
    </div>
    <div class="page-ft">
        <span class="fs32 color_w fw_b BGcolor_r postBtn">确认添加</span>
    </div>
</div>
</div>
</form>
{/block}

{block name="footer"}
<script>
var fd = new FormData();
$(function(){
	$('.postBtn').click(function (){
		if (fd.get('qrcodefile') == null){
			_alert('请选择图片.');
			return false;
		}
        var is_default = $('input[name="is_default"]:checked').val();
        fd.delete("is_default");
        fd.append("is_default",is_default);
        $.ajax({
            url: '{:url("unique/api.withdraw/addWeixin")}',
            type: 'post',
            processData: false,
            contentType: false,
            data: fd,
            success: function (res) {
                isPost = false;
                _alert(res.msg);
                if (res.code == 0){
                    return false;
                }
                window.location.href = '{:url("unique/withdraw/index")}';
            }
        })
	})
})
</script>
<script src="__STATIC__/mobile/default/js/uploadsimage.js?v=1"></script>
<script>
    //处理点击改变的调用函数-做IOS兼容
    $(_listenSelector).click(function(){
        var that = $(this);
        _uplocalfunction=function(base64Img){
            fd.append("qrcodefile", base64Img);
            $(that).parent().before('<div class="Box"><img src="'+base64Img+'" alt="" class="imgBox"><img src="__STATIC__/mobile/default/images/closeImg.png" alt="" class="closeImg" data-type="one"></div>');
            $('#upload_qrcode_box').css('visibility','hidden');
            //$(_listenSelector).hide();
        }
    })
</script>
{/block}